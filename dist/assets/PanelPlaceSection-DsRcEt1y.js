import{r as l,j as e,m as Oe,A as ur}from"./animations-w5RCdeks.js";import{u as pa,P as gr}from"./Places-BUd7dLOH.js";import{b as Fe,c as I,B as N,k as le,d as S,l as ha,D as ra,e as sa,f as ta,g as Pe}from"./index-Cjg6ZIXX.js";import{I as je}from"./input-Ct0LZSrI.js";import{T as xa}from"./textarea-B5bOgQR0.js";import{D as Be,a as qe,b as Ve,c as He,L as K,A as fa,e as ba,f as va,S as ve}from"./skeleton-BXey0m6W.js";import{C as Ae,c as Se,a as pr,b as hr}from"./card-Dck1QLHG.js";import{bD as ja,bl as $e,bE as Te,bm as xe,a3 as ye,bF as oa,br as wa,bG as Ge,bn as me,S as Re,X as Ue,bH as xr,a6 as Ye,bI as Na,R as fr,P as br,j as ya,bJ as vr,e as jr,C as wr,i as Nr,T as yr,D as Er,a as Ea,O as Cr,b as Dr,G as Ca,z as Xe,bK as Ar,M as ze,bh as Je,bL as Da,by as Pr,bM as Ze,bN as ga,bO as Mr,as as zr,bP as _e,bk as kr,bQ as _r}from"./ui-vuw2n6JC.js";import{u as Aa}from"./useModeracionImagen-CwbytiiN.js";import"./vendor-BImi-76D.js";import"./charts-qq9cUDqM.js";import"./utils-BNe0Xlio.js";const Sr=()=>{const[s,i]=l.useState(!1),[c,g]=l.useState(null),{toast:x}=Fe();return{cargando:s,error:c,validarDescripcionFoto:async R=>{try{i(!0),g(null),console.log("ðŸ” Validando descripciÃ³n de foto:",R.substring(0,50)+"...");const A=await I.post("/api/lugares/moderacion/validar-descripcion-foto",{descripcion:R});return console.log("âœ… Resultado validaciÃ³n descripciÃ³n:",A.data),A.data}catch(A){console.error("âŒ Error validando descripciÃ³n de foto:",A);const D=A.response?.data?.error||A.response?.data?.message||A.message||"Error al validar descripciÃ³n";throw g(D),x({title:"âŒ Error de validaciÃ³n",description:D,variant:"destructive"}),new Error(D)}finally{i(!1)}},analizarDescripcionFoto:async R=>{try{i(!0),g(null),console.log("ðŸ” Analizando descripciÃ³n de foto:",R.substring(0,50)+"...");const A=await I.post("/api/lugares/moderacion/analizar-descripcion-foto",{descripcion:R});return console.log("âœ… Resultado anÃ¡lisis descripciÃ³n:",A.data),A.data}catch(A){console.error("âŒ Error analizando descripciÃ³n de foto:",A);const D=A.response?.data?.error||A.response?.data?.message||A.message||"Error al analizar descripciÃ³n";throw g(D),x({title:"âŒ Error de anÃ¡lisis",description:D,variant:"destructive"}),new Error(D)}finally{i(!1)}},validarTextoGeneral:async(R,A="general")=>{try{return i(!0),g(null),(await I.post("/api/lugares/moderacion/analizar-texto",{texto:R,tipo_campo:A})).data}catch(D){console.error("âŒ Error validando texto general:",D);const T=D.response?.data?.error||D.response?.data?.message||D.message||"Error al validar texto";throw g(T),new Error(T)}finally{i(!1)}},limpiarError:()=>{g(null)}}},Pa=()=>{const[s,i]=l.useState([]),[c,g]=l.useState(!1),[x,y]=l.useState(null),{toast:p}=Fe(),C=o=>{console.log("ðŸ” [ERROR HANDLER] Analizando error:",o);const t=o;if(t?.response?.data){const r=t.response.data;if(console.log("ðŸ“¦ [ERROR HANDLER] Datos de error del servidor:",r),r.error&&(r.error==="CONTENIDO_RECHAZADO"||r.error==="IMAGEN_RECHAZADA"||r.error==="DESCRIPCION_RECHAZADA"||r.error==="TEXTO_RECHAZADO"||r.error==="VALIDACION_RECHAZADA"||r.error==="PDF_RECHAZADO"||r.error==="PDF_INVALIDO")){console.log("ðŸŽ¯ [ERROR HANDLER] Es error de moderaciÃ³n estructurado:",r);const a=r.detalles?{...r.detalles,problemas:r.detalles.problemas||[],sugerencias:r.detalles.sugerencias||[]}:void 0;return{message:r.message||"Contenido rechazado por moderaciÃ³n",motivo:r.motivo,tipo:r.tipo,detalles:a}}return r.motivo||r.message?(console.log("ðŸŽ¯ [ERROR HANDLER] Error con estructura alternativa:",r),{message:r.message||r.error||"Error de moderaciÃ³n",motivo:r.motivo,tipo:r.tipo||"general",detalles:r.detalles?{...r.detalles,problemas:r.detalles.problemas||[],sugerencias:r.detalles.sugerencias||[]}:{problemas:[r.motivo||r.message].filter(Boolean),sugerencias:["Revisa el contenido antes de intentar nuevamente"]}}):r.error||r.message||"Error del servidor"}return t?.message||"Error desconocido"},E=l.useCallback(o=>{if(console.log("ðŸŽ¯ [TOAST] Mostrando toast de rechazo:",o),typeof o=="string"){p({title:"ðŸš« Error",description:o,variant:"destructive",duration:8e3});return}let t="ðŸš« Contenido no aprobado",r=o.motivo||o.message;if((o.tipo==="pdf_texto"||o.tipo==="pdf")&&(t="ðŸš« PDF rechazado",r=o.motivo||"El contenido del PDF no cumple con las polÃ­ticas"),o.detalles?.problemas&&o.detalles.problemas.length>0){const a=o.detalles.problemas.filter(d=>d!==void 0);a.length>0&&(r+=`

Problemas detectados:
â€¢ ${a.join(`
â€¢ `)}`)}if(o.detalles?.sugerencias&&o.detalles.sugerencias.length>0){const a=o.detalles.sugerencias.filter(d=>d!==void 0);a.length>0&&(r+=`

Sugerencias:
â€¢ ${a.join(`
â€¢ `)}`)}o.detalles?.puntuacion&&(r+=`

Nivel de riesgo: ${(o.detalles.puntuacion*100).toFixed(1)}%`),(!r||r===o.message)&&(r=o.message||"El contenido no cumple con las polÃ­ticas de moderaciÃ³n"),p({title:t,description:r,variant:"destructive",duration:1e4})},[p]),{validarDescripcionFoto:R,analizarDescripcionFoto:A}=Sr(),D=o=>({id:o.id,name:o.nombre,description:o.descripcion,location:o.ubicacion,category:o.categoria,image_url:o.foto_principal_url||"",pdf_url:o.pdf_url||"",average_rating:o.puntuacion_promedio?Number(o.puntuacion_promedio):0,total_ratings:o.total_calificaciones?Number(o.total_calificaciones):0,total_experiences:o.total_experiencias?Number(o.total_experiencias):0,created_at:o.creado_en,updated_at:o.actualizado_en,gallery_images:[]}),T=o=>({nombre:o.name,descripcion:o.description,ubicacion:o.location,categoria:o.category,foto_principal_url:o.image_url,pdf_url:o.pdf_url}),F=l.useCallback((o,t)=>{const r={nombreModificado:t.name!==void 0&&t.name!==o.name,descripcionModificada:t.description!==void 0&&t.description!==o.description,ubicacionModificada:t.location!==void 0&&t.location!==o.location,categoriaModificada:t.category!==void 0&&t.category!==o.category,camposModificados:[],requiereModeracion:!1};return r.nombreModificado&&r.camposModificados.push("nombre"),r.descripcionModificada&&r.camposModificados.push("descripcion"),r.ubicacionModificada&&r.camposModificados.push("ubicacion"),r.categoriaModificada&&r.camposModificados.push("categoria"),r.requiereModeracion=r.nombreModificado||r.descripcionModificada,r},[]),G=l.useCallback(async(o,t)=>{try{console.log("ðŸ” Validando cambios previos para lugar:",o);const r=T(t),a=await I.post(`/api/lugares/${o}/validar-cambios`,r);return console.log("âœ… ValidaciÃ³n de cambios:",a.data),a.data}catch(r){const a=C(r);if(console.error("âŒ Error validando cambios:",a),typeof a=="object"&&"detalles"in a)return{success:!1,esAprobado:!1,mensaje:a.message,motivo:a.motivo||"Error de validaciÃ³n",cambios:{nombre:{modificado:!1},descripcion:{modificado:!1},ubicacion:{modificado:!1},categoria:{modificado:!1}},moderacion:{aplicada:!0,campos_moderados:["nombre","descripcion"],resultado:"rechazado"},detalles:{problemas:a.detalles?.problemas?.filter(h=>h!==void 0)||["Contenido no aprobado"],sugerencias:a.detalles?.sugerencias?.filter(h=>h!==void 0)||["Revisa el contenido antes de publicarlo","AsegÃºrate de que cumpla con las polÃ­ticas de la comunidad"]}};const d=typeof a=="string"?a:a.message;throw new Error(d)}},[]),oe=l.useCallback(async o=>{try{const t={};return o&&(t.hash_navegador=o),(await I.get("/api/lugares/moderacion/motivos-rechazo",{params:t})).data.motivos||[]}catch(t){return console.error("Error obteniendo motivos de rechazo:",t),[]}},[]),_=l.useCallback(async()=>{try{g(!0),y(null);const r=((await I.get("/api/lugares")).data.lugares||[]).map(D);return i(r),r}catch(o){const t=C(o);throw y(typeof t=="string"?t:t.message),new Error(typeof t=="string"?t:t.message)}finally{g(!1)}},[]),Q=l.useCallback(async(o,t)=>{try{if(g(!0),y(null),!o.name?.trim())throw new Error("El nombre del lugar es requerido");if(!o.description?.trim())throw new Error("La descripciÃ³n del lugar es requerida");if(!o.location?.trim())throw new Error("La ubicaciÃ³n del lugar es requerida");if(!o.category?.trim())throw new Error("La categorÃ­a del lugar es requerida");let r;t?(r=new FormData,r.append("nombre",o.name),r.append("descripcion",o.description),r.append("ubicacion",o.location),r.append("categoria",o.category),r.append("imagen",t),o.image_url&&r.append("foto_principal_url",o.image_url),o.pdf_url&&r.append("pdf_url",o.pdf_url)):r=T(o);const a=t?{headers:{"Content-Type":"multipart/form-data"},timeout:3e4}:{},d=await I.post("/api/lugares",r,a);if(!d.data.lugar)throw new Error("No se recibiÃ³ el lugar creado del servidor");const h=D(d.data.lugar);return i(v=>[...v,h]),p({title:"âœ… Lugar creado",description:"El lugar se ha creado exitosamente"}),h}catch(r){const a=C(r);if(console.log("âŒ [CREATE PLACE] Error capturado:",a),typeof a=="object"&&"detalles"in a)y(a),E(a);else{const d=typeof a=="string"?a:a.message;y(d),p({title:"âŒ Error",description:d,variant:"destructive"})}throw a}finally{g(!1)}},[p,E]),$=l.useCallback(async(o,t,r={})=>{try{console.log("ðŸŽ¯ [UPDATE PLACE] Iniciando actualizaciÃ³n:",{placeId:o,placeData:t,opciones:r}),g(!0),y(null);const{validarPreviamente:a=!0,skipValidacion:d=!1}=r,h=s.find(re=>re.id===o);if(!h)throw new Error("Lugar no encontrado en el estado local");const v=F(h,t);if(a&&!d&&v.requiereModeracion){console.log("ðŸ” Ejecutando validaciÃ³n previa...");const re=await G(o,t);if(!re.esAprobado){const B={message:re.mensaje,motivo:re.motivo||"El contenido no cumple con las polÃ­ticas de moderaciÃ³n",detalles:{problemas:re.detalles?.problemas||["Contenido no aprobado"],sugerencias:re.detalles?.sugerencias||["Revisa el contenido antes de publicarlo","AsegÃºrate de que cumpla con las polÃ­ticas de la comunidad"],campoEspecifico:v.nombreModificado&&v.descripcionModificada?"ambos":v.nombreModificado?"nombre":"descripcion"}};throw E(B),B}console.log("âœ… ValidaciÃ³n previa aprobada")}const U=T(t),J=await I.put(`/api/lugares/${o}`,U);if(!J.data.lugar)throw new Error("No se recibiÃ³ el lugar actualizado del servidor");const X=D(J.data.lugar);i(re=>re.map(B=>B.id===o?X:B));const Ne=v.camposModificados.length===0?"Lugar actualizado (sin cambios detectados)":`Lugar actualizado (${v.camposModificados.join(", ")})`;return p({title:"âœ… Lugar actualizado",description:Ne}),{lugar:X,cambios:v,respuesta:J.data}}catch(a){console.error("âŒ [UPDATE PLACE] Error completo:",a);const d=C(a);if(console.log("ðŸ” [UPDATE PLACE] Error procesado:",d),typeof d=="object"&&"detalles"in d)r.validarPreviamente||E(d);else{const h=typeof d=="string"?d:d.message;p({title:"âŒ Error",description:h,variant:"destructive"})}throw d}finally{g(!1)}},[s,F,G,p,E]),q=l.useCallback(async(o,t)=>$(o,t,{validarPreviamente:!1,skipValidacion:!0}),[$]),ee=l.useCallback(async(o,t)=>{const r={};return t.location!==void 0&&(r.location=t.location),t.category!==void 0&&(r.category=t.category),$(o,r,{validarPreviamente:!1,skipValidacion:!0})},[$]),Y=l.useCallback(async(o,t)=>{const r={};return t.name!==void 0&&(r.name=t.name),t.description!==void 0&&(r.description=t.description),$(o,r,{validarPreviamente:!0,skipValidacion:!1})},[$]),W=l.useCallback(async o=>{try{return g(!0),y(null),await I.delete(`/api/lugares/${o}`),i(t=>t.filter(r=>r.id!==o)),p({title:"âœ… Lugar eliminado",description:"El lugar se ha eliminado exitosamente"}),!0}catch(t){const r=C(t);throw y(typeof r=="string"?r:r.message),p({title:"âŒ Error",description:typeof r=="string"?r:r.message,variant:"destructive"}),new Error(typeof r=="string"?r:r.message)}finally{g(!1)}},[p]),k=l.useCallback(async(o,t)=>{try{console.log("ðŸ–¼ï¸ [UPLOAD] Subiendo imagen para lugar:",o);const r=new FormData;r.append("imagen",t);const a=await I.post(`/api/lugares/${o}/imagen`,r,{headers:{"Content-Type":"multipart/form-data"},timeout:3e4});return console.log("âœ… [UPLOAD] Imagen subida y aprobada correctamente"),i(d=>d.map(h=>h.id===o?{...h,image_url:a.data.url_imagen,gallery_images:[...h.gallery_images||[],{id:a.data.imagen_id,url_foto:a.data.url_imagen,descripcion:"Imagen principal del lugar",es_principal:!0,orden:1,creado_en:new Date().toISOString()}]}:h)),p({title:"âœ… Imagen aprobada",description:"La imagen ha sido subida y aprobada por moderaciÃ³n"}),a.data}catch(r){const a=C(r);if(console.error("âŒ [UPLOAD] Error subiendo imagen:",a),typeof a=="object"&&"detalles"in a)E(a);else{const d=typeof a=="string"?a:a.message;p({title:"âŒ Error",description:d,variant:"destructive"})}throw a}},[p,E]),V=l.useCallback(async(o,t)=>{try{console.log("ðŸ“„ [UPLOAD] Subiendo PDF con moderaciÃ³n para lugar:",o);const r=new FormData;r.append("pdf",t);const a=await I.post(`/api/lugares/${o}/pdf-con-moderacion`,r,{headers:{"Content-Type":"multipart/form-data"},timeout:45e3});if(console.log("âœ… [UPLOAD] PDF procesado con moderaciÃ³n:",a.data),a.data.moderacion&&!a.data.moderacion.esAprobado){const d={message:"El contenido del PDF no cumple con las polÃ­ticas de moderaciÃ³n",motivo:"Contenido inapropiado detectado en el PDF",tipo:"pdf_texto",detalles:{puntuacion:a.data.moderacion.puntuacion,problemas:["El PDF contiene texto que no cumple con las polÃ­ticas"],sugerencias:["Revisa que el PDF no contenga lenguaje ofensivo o inapropiado","AsegÃºrate de que el contenido sea apropiado para todos los pÃºblicos","Evita contenido promocional, spam o enlaces no permitidos"],campoEspecifico:"descripcion"}};throw E(d),d}return i(d=>d.map(h=>h.id===o?{...h,pdf_url:a.data.url_pdf}:h)),p({title:"âœ… PDF aprobado",description:"El PDF ha sido subido y aprobado por moderaciÃ³n"}),a.data}catch(r){if(console.error("âŒ [UPLOAD] Error subiendo PDF con moderaciÃ³n:",r),r.response?.data){const d=r.response.data;console.log("ðŸ“¦ [PDF UPLOAD ERROR] Datos del error:",d);const h={message:d.message||"El contenido del PDF no cumple con las polÃ­ticas",motivo:d.motivo||d.error,tipo:d.tipo||"pdf_texto",detalles:d.detalles||{problemas:[d.motivo||"Contenido inapropiado detectado"],sugerencias:["Revisa que el PDF no contenga lenguaje ofensivo o inapropiado","AsegÃºrate de que el contenido sea apropiado para todos los pÃºblicos","Evita contenido promocional, spam o enlaces no permitidos"],puntuacion:d.detalles?.puntuacion}};throw console.log("ðŸŽ¯ [PDF REJECTED] Mostrando toast especÃ­fico para PDF con detalles"),E(h),h}const a=C(r);if(typeof a=="object"&&"detalles"in a)console.log("ðŸŽ¯ [PDF REJECTED] Error de moderaciÃ³n capturado"),E(a);else{const d=typeof a=="string"?a:a.message;console.log("âš ï¸ [UPLOAD] Error genÃ©rico:",d),p({title:"âŒ Error",description:d,variant:"destructive"})}throw a}},[p,E]),P=l.useCallback(async(o,t)=>{try{console.log("ðŸ”„ [uploadMultipleImages] Subiendo imÃ¡genes a galerÃ­a:",{placeId:o,cantidad:t.length});const r=new FormData;t.forEach(h=>{r.append("imagenes",h)});const a=await I.post(`/api/lugares/${o}/imagenes`,r,{headers:{"Content-Type":"multipart/form-data"},timeout:3e4});console.log("âœ… [uploadMultipleImages] ImÃ¡genes procesadas:",a.data);const d=a.data.estadisticas?`${a.data.estadisticas.total_aprobadas} de ${a.data.estadisticas.total_enviadas} imÃ¡genes aprobadas`:`${t.length} imÃ¡genes procesadas`;return p({title:a.data.estadisticas?.total_rechazadas?"âš ï¸ Algunas imÃ¡genes rechazadas":"âœ… GalerÃ­a actualizada",description:d,variant:a.data.estadisticas?.total_rechazadas?"destructive":"default"}),a.data}catch(r){const a=C(r);if(console.error("âŒ [uploadMultipleImages] Error:",a),typeof a=="object"&&"detalles"in a)E(a);else{const d=typeof a=="string"?a:a.message;p({title:"âŒ Error",description:d,variant:"destructive"})}throw a}},[p,E]),ie=l.useCallback(async(o,t)=>{try{console.log("ðŸ”„ [replaceMainImage] Reemplazando imagen principal:",{placeId:o,fileName:t.name});const r=new FormData;r.append("imagen",t);const a=await I.put(`/api/lugares/${o}/imagen-principal`,r,{headers:{"Content-Type":"multipart/form-data"}});return console.log("âœ… [replaceMainImage] Imagen principal reemplazada:",a.data),i(d=>d.map(h=>h.id===o?{...h,image_url:a.data.url_imagen,gallery_images:h.gallery_images?.map(v=>v.es_principal?{...v,url_foto:a.data.url_imagen}:v)||[]}:h)),p({title:"âœ… Imagen principal actualizada",description:"La imagen principal se ha reemplazado correctamente"}),a.data}catch(r){const a=C(r);throw console.error("âŒ [replaceMainImage] Error:",a),p({title:"âŒ Error",description:"Error al reemplazar imagen principal",variant:"destructive"}),new Error(typeof a=="string"?a:a.message)}},[p]),ne=l.useCallback(async o=>{try{console.log("ðŸ”„ Obteniendo galerÃ­a para placeId:",o);const t=await I.get(`/api/lugares/${o}/galeria`);return console.log("âœ… Respuesta de galerÃ­a:",t.data),t.data.imagenes?t.data.imagenes:(console.warn("âš ï¸ No se encontraron imÃ¡genes en la respuesta"),[])}catch(t){console.error("âŒ Error obteniendo galerÃ­a:",{error:t,message:t?.message});const r=C(t);throw new Error(typeof r=="string"?r:r.message)}},[]),ae=l.useCallback(async(o,t)=>{try{return console.log("ðŸ—‘ï¸ Eliminando imagen:",{placeId:o,imageId:t}),await I.delete(`/api/lugares/${o}/galeria/${t}`),p({title:"âœ… Imagen eliminada",description:"La imagen ha sido eliminada de la galerÃ­a"}),!0}catch(r){console.error("âŒ Error eliminando imagen:",r);const a=C(r);throw p({title:"âŒ Error",description:typeof a=="string"?a:a.message,variant:"destructive"}),new Error(typeof a=="string"?a:a.message)}},[p]),ce=l.useCallback(async(o,t)=>{try{return console.log("â­ Estableciendo imagen principal:",{placeId:o,imageId:t}),await I.put(`/api/lugares/${o}/galeria/${t}/principal`),await _(),p({title:"âœ… Imagen principal actualizada",description:"La imagen se ha establecido como principal"}),!0}catch(r){console.error("âŒ Error estableciendo imagen principal:",r);const a=C(r);throw p({title:"âŒ Error",description:typeof a=="string"?a:a.message,variant:"destructive"}),new Error(typeof a=="string"?a:a.message)}},[_,p]),ue=l.useCallback(async(o,t)=>{try{g(!0),console.log("âœï¸ Actualizando descripciÃ³n con moderaciÃ³n:",{imageId:o,descripcion:t.substring(0,30)+"..."});const r=await R(t);if(!r.esAprobado){const h={message:r.mensaje,detalles:{problemas:r.detalles?.problemas,sugerencias:r.detalles?.sugerencias,puntuacion:r.puntuacion,campoEspecifico:"descripcion_foto"}};throw y(h),E(h),h}let a="";for(const h of s)if(h.gallery_images?.some(v=>v.id===o)){a=h.id;break}if(!a)throw new Error("No se pudo encontrar el lugar al que pertenece la imagen");const d=await I.put(`/api/lugares/${a}/galeria/${o}/descripcion`,{descripcion:t});return i(h=>h.map(v=>v.id===a?{...v,gallery_images:v.gallery_images?.map(U=>U.id===o?{...U,descripcion:t}:U)||[]}:v)),p({title:"âœ… DescripciÃ³n actualizada",description:"La descripciÃ³n se ha actualizado correctamente"}),d.data}catch(r){if(console.error("âŒ Error actualizando descripciÃ³n:",r),r.detalles)throw r;const a=r.response?.data?.error||r.message||"Error al actualizar descripciÃ³n";throw p({title:"âŒ Error",description:a,variant:"destructive"}),new Error(a)}finally{g(!1)}},[p,R,s,E]),de=l.useCallback(async o=>await A(o),[A]),be=l.useCallback(async o=>{try{const t=await I.delete(`/api/lugares/${o}/imagen-principal`);return i(r=>r.map(a=>{if(a.id!==o)return a;const d=t.data.nueva_imagen_principal;return{...a,image_url:d?.url_foto||"",gallery_images:a.gallery_images?.filter(h=>!h.es_principal).map((h,v)=>v===0&&d?{...h,es_principal:!0}:h)||[]}})),p({title:"âœ… Imagen principal eliminada",description:t.data.mensaje}),t.data}catch(t){const r=C(t);throw p({title:"âŒ Error",description:typeof r=="string"?r:r.message,variant:"destructive"}),new Error(typeof r=="string"?r:r.message)}},[p]),ge=l.useCallback(async o=>{try{if(g(!0),y(null),!o.name?.trim())throw new Error("El nombre del lugar es requerido");if(!o.description?.trim())throw new Error("La descripciÃ³n del lugar es requerida");if(!o.location?.trim())throw new Error("La ubicaciÃ³n del lugar es requerida");if(!o.category?.trim())throw new Error("La categorÃ­a del lugar es requerida");const t=T(o),r=await I.post("/api/lugares",t);if(!r.data.lugar)throw new Error("No se recibiÃ³ el lugar creado del servidor");const a=D(r.data.lugar);return i(d=>[...d,a]),console.log("âœ… [CREATE] Lugar creado bÃ¡sico:",a.id),a}catch(t){const r=C(t);if(typeof r=="object"&&r.detalles)y(JSON.stringify(r)),E(r);else{const a=typeof r=="string"?r:r.message;y(a),p({title:"âŒ Error",description:a,variant:"destructive"})}throw new Error(typeof r=="string"?r:r.message)}finally{g(!1)}},[p,E]),j=l.useCallback(async(o,t)=>{try{console.log("ðŸ–¼ï¸ [UPLOAD] Subiendo imagen para lugar:",o);const r=new FormData;r.append("imagen",t);const a=await I.post(`/api/lugares/${o}/imagen`,r,{headers:{"Content-Type":"multipart/form-data"},timeout:3e4});return console.log("âœ… [UPLOAD] Imagen subida correctamente"),i(d=>d.map(h=>h.id===o?{...h,image_url:a.data.url_imagen}:h)),a.data}catch(r){const a=C(r);throw new Error(typeof a=="string"?a:a.message)}},[]),pe=l.useCallback(async(o,t)=>{try{console.log("ðŸ“„ [UPLOAD] Subiendo PDF para lugar:",o);const r=new FormData;r.append("pdf",t);const a=await I.post(`/api/lugares/${o}/pdf`,r,{headers:{"Content-Type":"multipart/form-data"},timeout:3e4});return console.log("âœ… [UPLOAD] PDF subido correctamente"),i(d=>d.map(h=>h.id===o?{...h,pdf_url:a.data.url_pdf}:h)),a.data}catch(r){const a=C(r);throw new Error(typeof a=="string"?a:a.message)}},[]),he=l.useCallback(async o=>{try{console.log("ðŸ—‘ï¸ [DELETE] Eliminando imagen del lugar:",o);const t=await I.delete(`/api/lugares/${o}/imagen-principal`);return console.log("âœ… [DELETE] Imagen eliminada correctamente"),i(r=>r.map(a=>a.id===o?{...a,image_url:t.data.nueva_imagen_principal?.url_foto||"",gallery_images:a.gallery_images?.filter(d=>!d.es_principal)||[]}:a)),t.data}catch(t){const r=C(t);throw console.error("âŒ [DELETE] Error eliminando imagen:",r),new Error(typeof r=="string"?r:r.message)}},[]),we=l.useCallback(async o=>{try{console.log("ðŸ—‘ï¸ [DELETE] Eliminando PDF del lugar:",o);const t=await I.delete(`/api/lugares/${o}/pdf`);return console.log("âœ… [DELETE] PDF eliminado correctamente"),i(r=>r.map(a=>a.id===o?{...a,pdf_url:""}:a)),t.data}catch(t){const r=C(t);throw console.error("âŒ [DELETE] Error eliminando PDF:",r),new Error(typeof r=="string"?r:r.message)}},[]),H=l.useCallback(()=>{y(null)},[]);return{places:s,loading:c,error:x,createPlace:Q,updatePlace:$,updatePlaceFast:q,updatePlaceMetadata:ee,updatePlaceText:Y,deletePlace:W,uploadPlaceImage:k,uploadMultipleImages:P,getGallery:ne,deleteGalleryImage:ae,setMainImage:ce,fetchPlaces:_,uploadPlacePDFConModeracion:V,refetch:_,updateImageDescription:ue,deleteMainImage:be,obtenerMotivosRechazo:oe,createPlaceBasic:ge,uploadImageForPlace:j,uploadPDFForPlace:pe,replaceMainImage:ie,deletePlaceImage:he,deletePlacePDF:we,clearError:H,prevalidarDescripcion:de,validarCambiosLugar:G,analizarCambios:F}},Rr=s=>{if(!s)return"/placeholder.svg";if(s.startsWith("http"))return s;const i="https://backend-production-956f.up.railway.app",c=s.startsWith("/")?s:`/${s}`;return`${i}${c}`},Tr=({image:s,placeId:i,isOpen:c,onClose:g,onUpdate:x,onSetMain:y,onDelete:p,onReplaceMain:C,onUpdateDescription:E,onDeleteMain:R})=>{const[A,D]=l.useState(s.descripcion),[T,F]=l.useState(!1),[G,oe]=l.useState(!1),_=l.useRef(null),{toast:Q}=Fe(),$=async()=>{try{console.log("ðŸ’¾ Guardando descripciÃ³n:",{imageId:s.id,descripcion:A}),await E(s.id,A),F(!1),x(),Q({title:"âœ… DescripciÃ³n actualizada",description:"La descripciÃ³n se ha guardado correctamente"})}catch(k){console.error("âŒ Error guardando descripciÃ³n:",k);const V=k instanceof Error?k.message:"No se pudo actualizar la descripciÃ³n";Q({title:"âŒ Error",description:V,variant:"destructive"})}},q=async k=>{const V=k.target.files?.[0];if(V){console.log("ðŸ”„ [ImageEditor] Reemplazando IMAGEN PRINCIPAL:",V.name);try{oe(!0),await C(i,V),x(),g()}catch(P){console.error("âŒ [ImageEditor] Error reemplazando imagen principal:",P)}finally{oe(!1),_.current&&(_.current.value="")}}},ee=async()=>{if(window.confirm("Â¿EstÃ¡s seguro de que quieres eliminar la imagen principal? Se seleccionarÃ¡ automÃ¡ticamente otra imagen como principal si estÃ¡ disponible."))try{console.log("ðŸ—‘ï¸ Eliminando imagen principal:",s.id),await R(),x(),g()}catch(k){console.error("âŒ Error eliminando imagen principal:",k)}},Y=async()=>{try{console.log("â­ Estableciendo como principal:",s.id),await y(s.id),x(),g()}catch(k){console.error("âŒ Error estableciendo como principal:",k)}},W=async()=>{if(window.confirm("Â¿EstÃ¡s seguro de que quieres eliminar esta imagen?"))try{console.log("ðŸ—‘ï¸ Eliminando imagen:",s.id),await p(s.id),x(),g()}catch(k){console.error("âŒ Error eliminando imagen:",k)}};return e.jsx(Be,{open:c,onOpenChange:g,children:e.jsxs(qe,{className:"max-w-md bg-gradient-to-br from-emerald-100 to-cyan-800 text-black",children:[e.jsx(Ve,{children:e.jsxs(He,{className:"flex items-center gap-2",children:[e.jsx(ja,{className:"h-5 w-5"}),s.es_principal?"Imagen Principal":"Editar Imagen"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:Rr(s.url_foto),alt:s.descripcion,className:"max-h-48 rounded-lg object-cover",onError:k=>{k.target.src="/placeholder.svg"}})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{children:"DescripciÃ³n"}),T?e.jsxs("div",{className:"space-y-2 bg-slate-50 p-2 rounded",children:[e.jsx(xa,{className:"bg-white",value:A,onChange:k=>D(k.target.value),placeholder:"Describe esta imagen...",rows:3}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",className:"bg-green-900 text-white hover:bg-green-800",onClick:$,size:"sm",disabled:!A.trim(),children:"Guardar"}),e.jsx(N,{className:"bg-red-700 text-white hover:bg-red-600",variant:"outline",onClick:()=>{F(!1),D(s.descripcion)},size:"sm",children:"Cancelar"})]})]}):e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsx("p",{className:"text-sm flex-1",children:s.descripcion||"Sin descripciÃ³n"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>F(!0),children:e.jsx($e,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Orden: ",s.orden]}),e.jsxs("p",{children:["ID: ",s.id.substring(0,8),"..."]}),s.es_principal&&e.jsx("p",{className:"text-green-600 font-medium",children:"â­ Imagen principal"})]}),s.es_principal&&e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsx(K,{className:"text-sm font-medium",children:"Acciones de Imagen Principal"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{variant:"outline",className:"w-full justify-start bg-green-900 text-white hover:bg-green-800",onClick:()=>_.current?.click(),disabled:G,children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),G?"Subiendo...":"Reemplazar Imagen"]}),e.jsx(je,{ref:_,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:q,className:"hidden"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reemplaza esta imagen principal por una nueva"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{variant:"outline",className:"w-full justify-start bg-red-900 text-white hover:bg-red-800",onClick:ee,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Eliminar Imagen Principal"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Se seleccionarÃ¡ automÃ¡ticamente otra imagen como principal si estÃ¡ disponible"})]})]}),!s.es_principal&&e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsx(K,{className:"text-sm font-medium",children:"Acciones"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{className:"w-full justify-start bg-amber-600 hover:bg-amber-700 text-white",onClick:Y,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Establecer como Principal"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Convertir esta imagen en la imagen principal del lugar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{variant:"destructive",className:"w-full justify-start bg-red-900 text-white hover:bg-red-800",onClick:W,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Eliminar Imagen"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Elimina permanentemente esta imagen de la galerÃ­a"})]})]})]})]})})};class Ke extends l.Component{state={hasError:!1};static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,c){console.error("ðŸ›‘ [UploadErrorBoundary] Error en:",this.props.operation,i,c)}handleRetry=()=>{this.setState({hasError:!1,error:void 0}),this.props.onRetry?.()};handleReset=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs(fa,{variant:"destructive",className:"mb-4",children:[e.jsx(oa,{className:"h-4 w-4"}),e.jsxs(ba,{className:"flex flex-col gap-2",children:[e.jsxs("span",{children:["Error en ",this.props.operation]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{size:"sm",variant:"outline",onClick:this.handleRetry,className:"flex items-center gap-1",children:[e.jsx(wa,{className:"h-3 w-3"}),"Reintentar"]}),e.jsx(N,{size:"sm",variant:"ghost",onClick:this.handleReset,children:"Continuar"})]})]})]}):this.props.children}}const Fr=s=>{if(!s)return"/placeholder.svg";if(s.startsWith("http"))return s;const i="https://backend-production-956f.up.railway.app",c=s.startsWith("/")?s:`/${s}`;return`${i}${c}`},Lr=({onClick:s,disabled:i,uploading:c,fileCount:g,approvedCount:x})=>{const y=p=>{p.preventDefault(),p.stopPropagation(),console.log("ðŸ”„ [SafeUploadButton] Click prevenido y manejado"),s()};return e.jsx(Ke,{operation:"subida de imÃ¡genes",fallback:e.jsxs(N,{variant:"outline",disabled:!0,className:"w-full bg-gray-600 text-white",children:[e.jsx(oa,{className:"h-4 w-4 mr-2"}),"Error en subida"]}),children:e.jsx(N,{onClick:y,disabled:i,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:c?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 animate-spin mr-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),x>0?`Subir ${x} ImÃ¡genes Aprobadas`:`Subir ${g} ImÃ¡genes`]})})})},Ir=({analysisState:s})=>{const i=x=>{switch(x){case"pending":return"text-gray-400";case"analyzing":return"text-yellow-400";case"approved":return"text-green-400";case"rejected":return"text-red-400";default:return"text-gray-400"}},c=x=>{switch(x){case"pending":return e.jsx(me,{className:"h-3 w-3"});case"analyzing":return e.jsx(me,{className:"h-3 w-3 animate-spin"});case"approved":return e.jsx(Ye,{className:"h-3 w-3"});case"rejected":return e.jsx(xr,{className:"h-3 w-3"});default:return e.jsx(me,{className:"h-3 w-3"})}},g=x=>{switch(x){case"pending":return"Pendiente";case"analyzing":return"Analizando...";case"approved":return"Aprobada";case"rejected":return"Rechazada";default:return"Desconocido"}};return e.jsxs("div",{className:S("flex items-center gap-1 text-xs",i(s.status)),children:[c(s.status),e.jsx("span",{children:g(s.status)}),s.result&&s.status==="approved"&&e.jsxs("span",{className:"text-xs opacity-75",children:["(",Math.round(s.result.puntuacion*100),"%)"]})]})},Or=({placeId:s,placeName:i,isOpen:c,onClose:g,onGalleryUpdate:x})=>{const[y,p]=l.useState([]),[C,E]=l.useState(!1),[R,A]=l.useState(!1),[D,T]=l.useState([]),[F,G]=l.useState([]),oe=l.useRef(null),{toast:_}=Fe(),[Q,$]=l.useState(null),[q,ee]=l.useState(!1),[Y,W]=l.useState(null),[k,V]=l.useState(!0),{modelo:P,cargando:ie,errorModelo:ne,modeloCargado:ae,inicializarModelo:ce,analizarImagen:ue}=Aa(),{getGallery:de,uploadMultipleImages:be,deleteGalleryImage:ge,setMainImage:j,updateImageDescription:pe,deleteMainImage:he,replaceMainImage:we}=Pa();l.useEffect(()=>{c&&(console.log("ðŸ”„ Inicializando modelo para GalleryManager..."),ce())},[c,ce]);const H=l.useCallback(async()=>{try{E(!0),console.log("ðŸ”„ Cargando galerÃ­a para placeId:",s);const m=await de(s);console.log("âœ… GalerÃ­a cargada:",m),p(m||[])}catch(m){console.error("âŒ Error cargando galerÃ­a:",m);const f=m instanceof Error?m.message:"No se pudo cargar la galerÃ­a de imÃ¡genes";_({title:"âŒ Error",description:f,variant:"destructive"}),p([])}finally{E(!1)}},[s,de,_]);l.useEffect(()=>{c&&s?H():(p([]),T([]),G([]),$(null),ee(!1),W(null))},[c,s,H]);const o=l.useCallback(async m=>{try{if(G(b=>b.map(M=>M.fileName===m.name?{...M,status:"analyzing"}:M)),!P&&!ie)return console.warn("âš ï¸ Modelo de moderaciÃ³n no disponible en GalleryManager"),G(b=>b.map(M=>M.fileName===m.name?{...M,status:"approved",result:{esAprobado:!0,puntuacion:.5,razon:"Modelo no disponible - Aprobado por defecto"}}:M)),!0;ie&&(console.log("ðŸ”„ GalleryManager: Esperando a que cargue el modelo..."),await new Promise(b=>setTimeout(b,3e3)));const f=await ue(m);if(G(b=>b.map(M=>M.fileName===m.name?{...M,status:f.esAprobado?"approved":"rejected",result:f}:M)),!f.esAprobado){let b="";return f.razon?.includes("Porn")?b="La imagen contiene contenido pornogrÃ¡fico. Por favor, selecciona una imagen apropiada.":f.razon?.includes("Hentai")?b="La imagen contiene contenido de anime/manga inapropiado.":f.razon?.includes("Sexy")?b="La imagen contiene contenido sugerente. Las imÃ¡genes deben ser apropiadas para el turismo familiar.":b=f.razon||"La imagen no cumple con nuestras polÃ­ticas de contenido.",_({title:"ðŸš« Imagen rechazada",description:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:b}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Archivo:"})," ",m.name,e.jsx("br",{}),e.jsx("strong",{children:"PuntuaciÃ³n de seguridad:"})," ",f.puntuacion]})]}),variant:"destructive",duration:6e3}),!1}return console.log(`âœ… Imagen aprobada: ${m.name} (puntuaciÃ³n: ${f.puntuacion})`),!0}catch(f){return console.error(`âŒ Error analizando imagen ${m.name}:`,f),G(b=>b.map(M=>M.fileName===m.name?{...M,status:"approved",result:{esAprobado:!0,puntuacion:.3,razon:"Error en anÃ¡lisis - Aprobado por defecto"}}:M)),_({title:"âš ï¸ Advertencia",description:`No se pudo analizar "${m.name}". Se subirÃ¡ sin verificaciÃ³n completa.`,variant:"default",duration:5e3}),!0}},[P,ie,ue,_]),t=l.useCallback(async()=>{if(!(!k||D.length===0)){console.log("ðŸ” Iniciando anÃ¡lisis automÃ¡tico de archivos..."),G(D.map(m=>({fileName:m.name,status:"pending"})));for(let m=0;m<D.length;m++){const f=D[m];await o(f)}}},[k,D,o]);l.useEffect(()=>{k&&D.length>0&&t()},[D.length,k,t]);const r=m=>{$(m),ee(!0)},a=()=>{$(null),ee(!1)},d=async m=>{try{const f=Array.from(m.target.files||[]);console.log("ðŸ“ Archivos seleccionados:",f.length);const b=f.filter(M=>["image/jpeg","image/png","image/webp","image/jpg"].includes(M.type)?M.size>5242880?(_({title:"Archivo muy grande",description:`${M.name} excede el tamaÃ±o mÃ¡ximo de 5MB`,variant:"destructive"}),!1):!0:(_({title:"Tipo de archivo no vÃ¡lido",description:`${M.name} no es una imagen vÃ¡lida (JPEG, PNG, WebP)`,variant:"destructive"}),!1));T(M=>[...M,...b]),W(null),m.target.value=""}catch(f){console.error("âŒ Error seleccionando archivos:",f),W("Error al seleccionar archivos")}},h=m=>{const f=D[m];T(b=>b.filter((M,Z)=>Z!==m)),G(b=>b.filter(M=>M.fileName!==f.name))},v=async m=>{const f=D.find(b=>b.name===m);f&&await o(f)},U=async()=>{const m=D.filter((f,b)=>F[b]?.status==="approved");if(m.length===0){_({title:"âš ï¸ No hay imÃ¡genes aprobadas",description:"Todas las imÃ¡genes han sido rechazadas por el filtro de seguridad.",variant:"destructive"});return}try{A(!0),W(null),console.log("ðŸ“¤ [GalleryManager] Subiendo imÃ¡genes a GALERÃA:",m.length),await be(s,m);const f=`âœ… ${m.length} imÃ¡genes aprobadas agregadas a la galerÃ­a`;_({title:"âœ… Ã‰xito",description:f}),T([]),G([]),await H(),x?.()}catch(f){console.error("âŒ [GalleryManager] Error subiendo imÃ¡genes a galerÃ­a:",f);const b=f instanceof Error?f.message:"Error desconocido al subir imÃ¡genes";W(b),_({title:"âŒ Error",description:"Error al subir imÃ¡genes",variant:"destructive"})}finally{A(!1)}},J=async m=>{try{console.log("â­ Estableciendo como principal:",m),await j(s,m),await H(),x?.()}catch(f){console.error("âŒ Error estableciendo imagen principal:",f)}},X=async m=>{const f=y.find(M=>M.id===m),b=y.filter(M=>M.es_principal);if(f?.es_principal&&b.length===1){_({title:"âŒ Error",description:"No se puede eliminar la Ãºnica imagen principal",variant:"destructive"});return}try{console.log("ðŸ—‘ï¸ Eliminando imagen:",m),await ge(s,m),await H(),x?.()}catch(M){console.error("âŒ Error eliminando imagen:",M)}},Ne=async(m,f)=>{try{console.log("ðŸ”„ Reemplazando imagen principal:",f.name),await we(m,f),await H(),x?.()}catch(b){console.error("âŒ Error reemplazando imagen principal:",b)}},re=async(m,f)=>{try{console.log("ðŸ“ Actualizando descripciÃ³n desde GalleryManager:",{imageId:m,descripcion:f.substring(0,30)+"..."}),await pe(m,f),await H(),_({title:"âœ… DescripciÃ³n actualizada",description:"La descripciÃ³n se ha actualizado correctamente"})}catch(b){throw console.error("âŒ Error actualizando descripciÃ³n desde GalleryManager:",b),b.detalles||_({title:"âŒ Error",description:b.message||"Error al actualizar la descripciÃ³n",variant:"destructive"}),b}},B=async()=>{if(Q)try{console.log("ðŸ—‘ï¸ Eliminando imagen principal:",Q.id),await he(s),await H(),x?.(),a()}catch(m){console.error("âŒ Error eliminando imagen principal:",m)}},se={total:F.length,pending:F.filter(m=>m.status==="pending").length,analyzing:F.filter(m=>m.status==="analyzing").length,approved:F.filter(m=>m.status==="approved").length,rejected:F.filter(m=>m.status==="rejected").length},Le=m=>F.find(f=>f.fileName===m);return e.jsxs(e.Fragment,{children:[e.jsx(Be,{open:c,onOpenChange:g,children:e.jsxs(qe,{className:"max-w-4xl max-h-[90vh] overflow-auto bg-slate-900/95 backdrop-blur-sm border border-slate-700 shadow-xl text-white",children:[e.jsx(Ve,{className:"pb-4 border-b border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(He,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Ge,{className:"h-5 w-5"}),"GalerÃ­a de ImÃ¡genes - ",i]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ie&&e.jsxs(le,{variant:"outline",className:"text-yellow-400 border-yellow-400 text-xs",children:[e.jsx(me,{className:"h-3 w-3 animate-spin mr-1"}),"Cargando filtro..."]}),P&&e.jsxs(le,{variant:"outline",className:"text-green-400 border-green-400 text-xs",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),ae==="inception_v3"&&"Filtro Avanzado",ae==="mobilenet_v2"&&"Filtro Seguro",ae==="mobilenet_v2_mid"&&"Filtro Equilibrado"]}),ne&&e.jsxs(le,{variant:"outline",className:"text-red-400 border-red-400 text-xs",children:[e.jsx(oa,{className:"h-3 w-3 mr-1"}),"Filtro no disponible"]})]})]})}),e.jsxs("div",{className:"flex flex-col h-[calc(90vh-100px)]",children:[e.jsx(Ke,{operation:"gestiÃ³n de archivos de galerÃ­a",children:e.jsx(Ae,{className:"mb-6 bg-slate-800/50 border-slate-600",children:e.jsx(Se,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{className:"text-sm font-medium",children:"Agregar ImÃ¡genes a la GalerÃ­a"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Puedes seleccionar mÃºltiples imÃ¡genes (JPEG, PNG, WebP, mÃ¡ximo 5MB cada una)"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"auto-analyze",checked:k,onChange:m=>V(m.target.checked),className:"rounded border-slate-600 bg-slate-700"}),e.jsx(K,{htmlFor:"auto-analyze",className:"text-sm text-slate-300",children:"AnÃ¡lisis automÃ¡tico de seguridad"})]}),e.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:[e.jsx(Re,{className:"h-3 w-3 inline mr-1"}),"Todas las imÃ¡genes pasan por un filtro de seguridad automÃ¡tico"]})]}),D.length>0&&k&&e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(K,{className:"text-sm font-medium",children:"AnÃ¡lisis de Seguridad"}),se.analyzing>0&&e.jsxs("span",{className:"text-yellow-400 text-xs",children:["Analizando ",se.analyzing,"..."]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400",children:"Total"}),e.jsx("div",{className:"text-white font-medium",children:se.total})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-yellow-400",children:"Pendiente"}),e.jsx("div",{className:"text-white font-medium",children:se.pending})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-green-400",children:"Aprobadas"}),e.jsx("div",{className:"text-white font-medium",children:se.approved})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-400",children:"Rechazadas"}),e.jsx("div",{className:"text-white font-medium",children:se.rejected})]})]})]}),D.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{className:"text-sm",children:["ImÃ¡genes a subir (",D.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 max-h-48 overflow-y-auto",children:D.map((m,f)=>{const b=Le(m.name);return e.jsxs("div",{className:S("relative group rounded-md p-2 transition-all border",b?.status==="approved"?"bg-green-900/20 border-green-600":b?.status==="rejected"?"bg-red-900/20 border-red-600":b?.status==="analyzing"?"bg-yellow-900/20 border-yellow-600":"bg-slate-700 border-slate-600"),children:[e.jsx("img",{src:URL.createObjectURL(m),alt:m.name,className:"w-full h-16 object-cover rounded"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center",children:e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>h(f),className:"h-8 w-8 p-0 text-white hover:bg-red-500",disabled:b?.status==="analyzing",children:e.jsx(Ue,{className:"h-4 w-4"})})}),b&&e.jsxs("div",{className:"mt-2",children:[e.jsx(Ir,{analysisState:b}),b.status==="rejected"&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>v(m.name),className:"w-full mt-1 h-6 text-xs bg-blue-600 hover:bg-blue-700 border-blue-500",children:"Reanalizar"})]}),!b&&k&&e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Pendiente de anÃ¡lisis"}),!k&&e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"AnÃ¡lisis manual requerido"}),e.jsx("p",{className:"text-xs text-slate-300 truncate mt-1",children:m.name})]},f)})}),e.jsx(Lr,{onClick:U,disabled:R||k&&se.analyzing>0,uploading:R,fileCount:D.length,approvedCount:se.approved,totalCount:se.total}),Y&&e.jsx(fa,{variant:"destructive",className:"mt-2",children:e.jsx(ba,{className:"text-sm",children:Y})})]}),e.jsx(Ke,{operation:"selecciÃ³n de archivos",children:e.jsxs("div",{className:S("border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors",D.length===0?"border-slate-500 hover:border-slate-400 bg-slate-800/30 hover:bg-slate-800/50":"border-slate-600 bg-slate-800/20"),onClick:()=>{console.log("ðŸ–±ï¸ Click en Ã¡rea de drop"),oe.current?.click()},onDragOver:m=>{m.preventDefault(),m.stopPropagation()},onDrop:m=>{m.preventDefault(),m.stopPropagation(),console.log("ðŸ“‚ Archivos arrastrados:",m.dataTransfer.files.length);const f=Array.from(m.dataTransfer.files);T(b=>[...b,...f])},children:[e.jsx(Te,{className:"h-8 w-8 mx-auto text-slate-400 mb-2"}),e.jsx("p",{className:"text-sm text-slate-300 mb-1",children:"Arrastra imÃ¡genes aquÃ­ o haz clic para seleccionar"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Formatos: JPEG, PNG, WebP â€¢ MÃ¡ximo 5MB por imagen"}),e.jsxs("div",{className:"mt-2 text-xs text-blue-400",children:[e.jsx(Re,{className:"h-3 w-3 inline mr-1"}),"Todas las imÃ¡genes serÃ¡n analizadas por seguridad"]})]})}),e.jsx(je,{ref:oe,type:"file",multiple:!0,accept:"image/jpeg,image/png,image/webp,image/jpg",onChange:d,className:"hidden"})]})})})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(K,{className:"text-sm font-medium",children:["GalerÃ­a Actual (",y.length," imÃ¡genes)"]}),C&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(me,{className:"h-3 w-3 animate-spin"}),"Cargando..."]})]}),C?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(me,{className:"h-8 w-8 animate-spin mx-auto text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-400 mt-2",children:"Cargando galerÃ­a..."})]}):y.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsx(ja,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No hay imÃ¡genes en la galerÃ­a"}),e.jsx("p",{className:"text-xs mt-1",children:"Agrega imÃ¡genes usando el formulario de arriba"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-h-96 overflow-y-auto pr-2",children:y.map((m,f)=>e.jsxs("div",{className:"relative group bg-slate-800 rounded-lg overflow-hidden border border-slate-700 cursor-pointer",onClick:()=>r(m),children:[e.jsx("img",{src:Fr(m.url_foto),alt:m.descripcion,className:"w-full h-32 object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-between p-2",children:[m.es_principal&&e.jsx("div",{className:"flex justify-start",children:e.jsxs(le,{className:"bg-amber-500 text-white text-xs",children:[e.jsx(ye,{className:"h-3 w-3 mr-1 fill-current"}),"Principal"]})}),e.jsxs("div",{className:"flex justify-center gap-1",children:[!m.es_principal&&e.jsxs(N,{size:"sm",onClick:b=>{b.stopPropagation(),J(m.id)},className:"h-7 px-2 text-xs bg-amber-600 hover:bg-amber-700 text-white",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"Principal"]}),!(m.es_principal&&y.filter(b=>b.es_principal).length===1)&&e.jsx(N,{size:"sm",onClick:b=>{b.stopPropagation(),X(m.id)},className:"h-7 px-2 text-xs bg-red-600 hover:bg-red-700 text-white",children:e.jsx(xe,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 p-2",children:[e.jsx("p",{className:"text-xs text-white truncate",children:m.descripcion||`Imagen ${f+1}`}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Orden: ",m.orden]}),m.es_principal&&e.jsx(ye,{className:"h-3 w-3 text-amber-400 absolute top-2 right-2"})]})]},m.id))})]})]})]})}),Q&&e.jsx(Tr,{image:Q,placeId:s,isOpen:q,onClose:a,onUpdate:H,onSetMain:J,onDelete:X,onReplaceMain:Ne,onUpdateDescription:re,onDeleteMain:B})]})};var $r=Symbol("radix.slottable");function Gr(s){const i=({children:c})=>e.jsx(e.Fragment,{children:c});return i.displayName=`${s}.Slottable`,i.__radixId=$r,i}var Ma="AlertDialog",[Ur]=jr(Ma,[Na]),fe=Na(),za=s=>{const{__scopeAlertDialog:i,...c}=s,g=fe(i);return e.jsx(fr,{...g,...c,modal:!0})};za.displayName=Ma;var Br="AlertDialogTrigger",qr=l.forwardRef((s,i)=>{const{__scopeAlertDialog:c,...g}=s,x=fe(c);return e.jsx(Dr,{...x,...g,ref:i})});qr.displayName=Br;var Vr="AlertDialogPortal",ka=s=>{const{__scopeAlertDialog:i,...c}=s,g=fe(i);return e.jsx(br,{...g,...c})};ka.displayName=Vr;var Hr="AlertDialogOverlay",_a=l.forwardRef((s,i)=>{const{__scopeAlertDialog:c,...g}=s,x=fe(c);return e.jsx(Cr,{...x,...g,ref:i})});_a.displayName=Hr;var Me="AlertDialogContent",[Wr,Jr]=Ur(Me),Zr=Gr("AlertDialogContent"),Sa=l.forwardRef((s,i)=>{const{__scopeAlertDialog:c,children:g,...x}=s,y=fe(c),p=l.useRef(null),C=ya(i,p),E=l.useRef(null);return e.jsx(vr,{contentName:Me,titleName:Ra,docsSlug:"alert-dialog",children:e.jsx(Wr,{scope:c,cancelRef:E,children:e.jsxs(wr,{role:"alertdialog",...y,...x,ref:C,onOpenAutoFocus:Nr(x.onOpenAutoFocus,R=>{R.preventDefault(),E.current?.focus({preventScroll:!0})}),onPointerDownOutside:R=>R.preventDefault(),onInteractOutside:R=>R.preventDefault(),children:[e.jsx(Zr,{children:g}),e.jsx(Xr,{contentRef:p})]})})})});Sa.displayName=Me;var Ra="AlertDialogTitle",Ta=l.forwardRef((s,i)=>{const{__scopeAlertDialog:c,...g}=s,x=fe(c);return e.jsx(yr,{...x,...g,ref:i})});Ta.displayName=Ra;var Fa="AlertDialogDescription",La=l.forwardRef((s,i)=>{const{__scopeAlertDialog:c,...g}=s,x=fe(c);return e.jsx(Er,{...x,...g,ref:i})});La.displayName=Fa;var Yr="AlertDialogAction",Ia=l.forwardRef((s,i)=>{const{__scopeAlertDialog:c,...g}=s,x=fe(c);return e.jsx(Ea,{...x,...g,ref:i})});Ia.displayName=Yr;var Oa="AlertDialogCancel",$a=l.forwardRef((s,i)=>{const{__scopeAlertDialog:c,...g}=s,{cancelRef:x}=Jr(Oa,c),y=fe(c),p=ya(i,x);return e.jsx(Ea,{...y,...g,ref:p})});$a.displayName=Oa;var Xr=({contentRef:s})=>{const i=`\`${Me}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Me}\` by passing a \`${Fa}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Me}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{document.getElementById(s.current?.getAttribute("aria-describedby"))||console.warn(i)},[i,s]),null},Kr=za,Qr=ka,Ga=_a,Ua=Sa,Ba=Ia,qa=$a,Va=Ta,Ha=La;const es=Kr,as=Qr,Wa=l.forwardRef(({className:s,...i},c)=>e.jsx(Ga,{className:S("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...i,ref:c}));Wa.displayName=Ga.displayName;const Ja=l.forwardRef(({className:s,...i},c)=>e.jsxs(as,{children:[e.jsx(Wa,{}),e.jsx(Ua,{ref:c,className:S("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...i})]}));Ja.displayName=Ua.displayName;const Za=({className:s,...i})=>e.jsx("div",{className:S("flex flex-col space-y-2 text-center sm:text-left",s),...i});Za.displayName="AlertDialogHeader";const Ya=({className:s,...i})=>e.jsx("div",{className:S("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...i});Ya.displayName="AlertDialogFooter";const Xa=l.forwardRef(({className:s,...i},c)=>e.jsx(Va,{ref:c,className:S("text-lg font-semibold",s),...i}));Xa.displayName=Va.displayName;const Ka=l.forwardRef(({className:s,...i},c)=>e.jsx(Ha,{ref:c,className:S("text-sm text-muted-foreground",s),...i}));Ka.displayName=Ha.displayName;const Qa=l.forwardRef(({className:s,...i},c)=>e.jsx(Ba,{ref:c,className:S(ha(),s),...i}));Qa.displayName=Ba.displayName;const er=l.forwardRef(({className:s,...i},c)=>e.jsx(qa,{ref:c,className:S(ha({variant:"outline"}),"mt-2 sm:mt-0",s),...i}));er.displayName=qa.displayName;const ar=l.forwardRef(({className:s,...i},c)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:c,className:S("w-full caption-bottom text-sm",s),...i})}));ar.displayName="Table";const rr=l.forwardRef(({className:s,...i},c)=>e.jsx("thead",{ref:c,className:S("[&_tr]:border-b",s),...i}));rr.displayName="TableHeader";const sr=l.forwardRef(({className:s,...i},c)=>e.jsx("tbody",{ref:c,className:S("[&_tr:last-child]:border-0",s),...i}));sr.displayName="TableBody";const rs=l.forwardRef(({className:s,...i},c)=>e.jsx("tfoot",{ref:c,className:S("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...i}));rs.displayName="TableFooter";const Qe=l.forwardRef(({className:s,...i},c)=>e.jsx("tr",{ref:c,className:S("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...i}));Qe.displayName="TableRow";const Ce=l.forwardRef(({className:s,...i},c)=>e.jsx("th",{ref:c,className:S("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...i}));Ce.displayName="TableHead";const De=l.forwardRef(({className:s,...i},c)=>e.jsx("td",{ref:c,className:S("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...i}));De.displayName="TableCell";const ss=l.forwardRef(({className:s,...i},c)=>e.jsx("caption",{ref:c,className:S("mt-4 text-sm text-muted-foreground",s),...i}));ss.displayName="TableCaption";const ts=({value:s,onValueChange:i,error:c,placeholder:g="Selecciona una categorÃ­a",categories:x})=>{const[y,p]=l.useState(!1),C=E=>{i(E),p(!1)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ra,{open:y,onOpenChange:p,children:[e.jsx(sa,{asChild:!0,children:e.jsxs(N,{title:"Seleccionar categorÃ­a",variant:"outline",className:S("w-full justify-between border-blue-200 focus:border-blue-500",c&&"border-red-500",!s&&"text-muted-foreground"),children:[e.jsx("span",{children:s||g}),e.jsx(Ca,{className:"h-4 w-4 opacity-50"})]})}),e.jsx(ta,{className:"w-full max-h-60 overflow-y-auto bg-white border border-gray-200 shadow-lg",align:"start",children:x.map(E=>e.jsxs(Pe,{onClick:()=>C(E),className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{children:E}),s===E&&e.jsx(Xe,{className:"h-4 w-4 text-blue-600"})]},E))})]}),c&&e.jsx("p",{className:"text-sm text-red-600",children:c})]})},os=({value:s,onValueChange:i,categories:c})=>{const[g,x]=l.useState(!1),y=C=>{i(C),x(!1)},p=s==="all"?"Todas las categorÃ­as":s;return e.jsxs(ra,{open:g,onOpenChange:x,children:[e.jsx(sa,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start border-blue-200 focus:border-blue-500",title:"Filtrar por categorÃ­a",children:[e.jsx(Ar,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"truncate",children:p}),e.jsx(Ca,{className:"h-4 w-4 opacity-50 ml-auto"})]})}),e.jsxs(ta,{className:"w-full max-h-60 overflow-y-auto bg-white border border-gray-200 shadow-lg",align:"start",children:[e.jsxs(Pe,{onClick:()=>y("all"),className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{children:"Todas las categorÃ­as"}),s==="all"&&e.jsx(Xe,{className:"h-4 w-4 text-blue-600"})]}),c.map(C=>e.jsxs(Pe,{onClick:()=>y(C),className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{children:C}),s===C&&e.jsx(Xe,{className:"h-4 w-4 text-blue-600"})]},C))]})]})},is=({onLocationSelect:s,currentLocation:i,buttonText:c="Seleccionar UbicaciÃ³n",className:g})=>{const[x,y]=l.useState(!1),[p,C]=l.useState(""),[E,R]=l.useState(null),[A,D]=l.useState(null),[T,F]=l.useState(null),[G,oe]=l.useState(null),[_,Q]=l.useState(!0),[$,q]=l.useState(!1),[ee,Y]=l.useState(null),[W,k]=l.useState("hybrid"),V=l.useRef(null),P=l.useRef(null),ie=l.useRef(null),ne=l.useRef(null);l.useEffect(()=>(x?ce():(ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{ae()},100)),()=>{ne.current&&clearTimeout(ne.current),ae()}),[x]);const ae=()=>{try{T&&(T.setMap(null),F(null)),G&&(window.google?.maps.event.clearInstanceListeners(G),oe(null)),ie.current&&(window.google?.maps.event.clearInstanceListeners(ie.current),ie.current=null),D(null)}catch(a){console.warn("Error durante la limpieza del mapa:",a)}},ce=()=>{if(ae(),q(!0),Y(null),window.google)setTimeout(()=>be(),100);else{const a=document.createElement("script");a.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAyGMepBWIz2iAe2RZXcXSB27qwPH3tx2Q&libraries=places",a.async=!0,a.defer=!0,a.onload=()=>{setTimeout(()=>be(),100)},a.onerror=()=>{Y("Error al cargar Google Maps. Verifica tu API key."),q(!1)},document.head.appendChild(a)}},ue=()=>{ce()},de=a=>{A&&(A.setMapTypeId(a),k(a))},be=()=>{if(!V.current||!window.google){Y("Google Maps no se pudo inicializar correctamente."),q(!1);return}try{V.current&&(V.current.innerHTML="");const a={lat:19.939088388469845,lng:-97.55492145455479},d=new window.google.maps.Map(V.current,{center:a,zoom:15,mapTypeId:"hybrid",streetViewControl:!0,streetViewControlOptions:{position:window.google.maps.ControlPosition.RIGHT_TOP},fullscreenControl:!0,fullscreenControlOptions:{position:window.google.maps.ControlPosition.RIGHT_TOP},zoomControl:!0,zoomControlOptions:{position:window.google.maps.ControlPosition.RIGHT_CENTER},styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f8fafc"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#64748b"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e0f2fe"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f1f5f9"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#cbd5e1"}]}]});if(ie.current=d,P.current){const v=new window.google.maps.places.Autocomplete(P.current,{types:["geocode","establishment"]});v.bindTo("bounds",d),v.addListener("place_changed",()=>{const U=v.getPlace();U.geometry&&pe(U)}),oe(v)}const h=new window.google.maps.Marker({map:d,position:a,draggable:!0,animation:window.google.maps.Animation.DROP,title:"UbicaciÃ³n seleccionada",icon:{url:"data:image/svg+xml;base64,"+btoa(`
            <svg width="32" height="40" viewBox="0 0 32 40" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 0C10.48 0 6 4.48 6 10C6 17.08 16 40 16 40C16 40 26 17.08 26 10C26 4.48 21.52 0 16 0Z" fill="#3b82f6"/>
              <circle cx="16" cy="10" r="5" fill="white"/>
              <circle cx="16" cy="10" r="3" fill="#3b82f6"/>
            </svg>
          `),scaledSize:new window.google.maps.Size(32,40),anchor:new window.google.maps.Point(16,40)}});h.addListener("dragend",()=>{const v=h.getPosition();j(v,d)}),d.addListener("click",v=>{h.setPosition(v.latLng),j(v.latLng,d)}),d.addListener("maptypeid_changed",()=>{k(d.getMapTypeId())}),D(d),F(h),q(!1),i&&setTimeout(()=>{ge(i,d,h)},500)}catch(a){Y("Error al inicializar el mapa: "+a),q(!1)}},ge=(a,d,h)=>{new window.google.maps.Geocoder().geocode({address:a},(U,J)=>{if(J==="OK"&&U[0]){const X=U[0].geometry.location;d.setCenter(X),h.setPosition(X),j(X,d)}})},j=async(a,d)=>{new window.google.maps.Geocoder().geocode({location:a},(v,U)=>{if(U==="OK"&&v[0]){const X={address:v[0].formatted_address,lat:a.lat(),lng:a.lng()};R(X),d.setCenter(a)}})},pe=a=>{if(!a.geometry||!A||!T)return;a.geometry.viewport?A.fitBounds(a.geometry.viewport):(A.setCenter(a.geometry.location),A.setZoom(17)),T.setPosition(a.geometry.location);const d={address:a.formatted_address,lat:a.geometry.location.lat(),lng:a.geometry.location.lng()};R(d)},he=()=>{if(!navigator.geolocation){alert("La geolocalizaciÃ³n no es soportada por este navegador");return}q(!0),navigator.geolocation.getCurrentPosition(a=>{const d={lat:a.coords.latitude,lng:a.coords.longitude};A&&T&&(A.setCenter(d),T.setPosition(d),j(d,A)),q(!1)},()=>{alert("Error al obtener la ubicaciÃ³n actual"),q(!1)},{timeout:1e4})},we=()=>{E&&(s(E),y(!1))},H=()=>{R(null),y(!1)},o=a=>W===a?"default":"outline",t=a=>{switch(a){case"satellite":return e.jsx(Mr,{className:"h-4 w-4"});case"hybrid":return e.jsx(Ze,{className:"h-4 w-4"});case"terrain":return e.jsx(ga,{className:"h-4 w-4"});default:return e.jsx(ga,{className:"h-4 w-4"})}},r=a=>{switch(a){case"roadmap":return"Mapa";case"satellite":return"SatÃ©lite";case"hybrid":return"HÃ­brido";case"terrain":return"Terreno";default:return"Mapa"}};return e.jsxs(Be,{open:x,onOpenChange:y,children:[e.jsx(va,{asChild:!0,children:e.jsxs(N,{type:"button",variant:"outline",className:S("justify-start gap-2 border-blue-300 text-blue-700 hover:bg-blue-50 hover:text-blue-800",g),children:[e.jsx(ze,{className:"h-4 w-4"}),i||c]})}),e.jsxs(qe,{className:"max-w-4xl h-[85vh] flex flex-col bg-gradient-to-br from-blue-50/80 to-indigo-100/80 backdrop-blur-sm border border-blue-200/50 shadow-2xl rounded-2xl",children:[e.jsxs(Ve,{className:"flex flex-row items-center justify-between pb-4 border-b border-blue-200/30",children:[e.jsx(He,{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"ðŸ—ºï¸ Seleccionar UbicaciÃ³n en el Mapa"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(N,{variant:"outline",size:"sm",onClick:ue,className:"gap-2 border-blue-200 text-blue-700 hover:bg-blue-100",disabled:$,children:[e.jsx(Je,{className:`h-4 w-4 ${$?"animate-spin":""}`}),"Recargar"]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Da,{className:"absolute left-3 top-3 h-4 w-4 text-blue-500"}),e.jsx(je,{ref:P,placeholder:"Buscar direcciÃ³n, lugar o punto de interÃ©s...",value:p,onChange:a=>C(a.target.value),className:"pl-9 border-blue-200 focus:border-blue-500 bg-white/80"})]}),e.jsxs(N,{type:"button",variant:"outline",onClick:he,className:"gap-2 border-blue-200 text-blue-700 hover:bg-blue-100",disabled:$,children:[e.jsx(Pr,{className:"h-4 w-4"}),"Mi ubicaciÃ³n"]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[["roadmap","satellite","hybrid","terrain"].map(a=>e.jsxs(N,{variant:o(a),size:"sm",onClick:()=>de(a),className:"gap-2 border-blue-200 text-blue-700 hover:bg-blue-100 data-[state=on]:bg-blue-600 data-[state=on]:text-white",children:[t(a),r(a)]},a)),e.jsxs(le,{variant:"secondary",className:"ml-auto bg-blue-100 text-blue-800 border-blue-200",children:["Vista: ",r(W)]})]}),e.jsxs("div",{className:"flex-1 relative rounded-xl overflow-hidden border-2 border-blue-200/50 bg-white",children:[$&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-blue-50/50 z-10",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(Je,{className:"h-8 w-8 text-blue-600 animate-spin"}),e.jsx("p",{className:"text-blue-700 font-medium",children:"Cargando mapa..."})]})}),ee&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50/80 z-10",children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Error al cargar el mapa"}),e.jsx("p",{className:"text-red-500 text-sm mb-4",children:ee}),e.jsxs(N,{onClick:ue,className:"gap-2 bg-red-600 hover:bg-red-700",children:[e.jsx(Je,{className:"h-4 w-4"}),"Reintentar"]})]})}),e.jsx("div",{ref:V,className:"w-full h-full"}),_&&e.jsxs("div",{className:"absolute top-4 left-4 bg-white/95 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-blue-200 max-w-xs z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h3",{className:"font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),"Instrucciones"]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>Q(!1),className:"h-6 w-6 p-0 text-blue-400 hover:text-blue-600",children:e.jsx(Ue,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsx("p",{children:"â€¢ ðŸ–±ï¸ Haz clic en el mapa para colocar un marcador"}),e.jsx("p",{children:"â€¢ ðŸ” Busca una direcciÃ³n en la barra superior"}),e.jsx("p",{children:"â€¢ ðŸ“ Arrastra el marcador para ajustar la posiciÃ³n"}),e.jsx("p",{children:"â€¢ ðŸ›°ï¸ Cambia la vista con los botones de tipo de mapa"}),e.jsx("p",{children:'â€¢ ðŸ§­ Usa "Mi ubicaciÃ³n" para centrar en tu posiciÃ³n'})]})]}),!_&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>Q(!0),className:"absolute top-4 left-4 bg-white/90 backdrop-blur-sm border-blue-200 text-blue-700 hover:bg-blue-50 z-10",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Mostrar instrucciones"]})]}),E&&e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5 text-green-600"}),e.jsx(K,{className:"text-green-800 font-semibold",children:"UbicaciÃ³n seleccionada:"})]}),e.jsx(le,{variant:"outline",className:"bg-green-100 text-green-800 border-green-300",children:"âœ“ Lista"})]}),e.jsx("p",{className:"text-sm text-green-700 font-medium",children:E.address}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["ðŸ“ Coordenadas: ",E.lat.toFixed(6),", ",E.lng.toFixed(6)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-blue-200/30",children:[e.jsx("div",{className:"text-sm text-blue-600",children:E?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-4 w-4 text-green-600"}),"UbicaciÃ³n seleccionada correctamente"]}):e.jsx("span",{children:"ðŸ‘† Selecciona una ubicaciÃ³n en el mapa"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(N,{variant:"outline",onClick:H,className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:"Cancelar"}),e.jsxs(N,{onClick:we,disabled:!E||$,className:"gap-2 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg",children:[e.jsx(ze,{className:"h-4 w-4"}),"Confirmar UbicaciÃ³n"]})]})]})]})]})},ea=({text:s,maxLength:i=150,className:c,showToggle:g=!0,renderText:x})=>{const[y,p]=l.useState(!1);if(!s)return e.jsx("span",{className:"text-gray-500 italic text-sm",children:"Sin descripciÃ³n"});const C=s.length>i,E=y||!C?s:`${s.slice(0,i)}...`;return e.jsxs("div",{className:S("space-y-1",c),children:[e.jsx("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed",children:x?x(E):E}),C&&g&&e.jsx(N,{variant:"link",size:"sm",onClick:()=>p(!y),className:"h-auto p-0 text-blue-600 hover:text-blue-800 text-xs font-normal",children:y?"Ver menos":"Ver mÃ¡s"})]})};class ns extends l.Component{state={hasError:!1};static getDerivedStateFromError(i){return console.log("ðŸ›¡ï¸ [FormErrorBoundary] Error capturado:",i.message),{hasError:!0,error:i}}componentDidCatch(i,c){console.error("ðŸ›¡ï¸ [FormErrorBoundary] Error:",i),console.error("ðŸ›¡ï¸ [FormErrorBoundary] Error Info:",c)}render(){return this.state.hasError?this.props.fallback||e.jsxs("div",{className:"p-4 border border-red-300 bg-red-50 rounded-lg",children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Error en el formulario"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:"Ha ocurrido un error. Por favor, intenta nuevamente."}),e.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"mt-2 px-3 py-1 bg-red-600 text-white rounded text-sm",children:"Reintentar"})]}):this.props.children}}class Ee extends l.Component{state={hasError:!1};static getDerivedStateFromError(i){return console.log("ðŸ›¡ï¸ [AdminErrorBoundary] Error capturado:",i.message),{hasError:!0,error:i}}componentDidCatch(i,c){console.error(`ðŸ›¡ï¸ [AdminErrorBoundary] Error en ${this.props.operation||"operaciÃ³n"}:`,i),console.error("ðŸ›¡ï¸ [AdminErrorBoundary] Error Info:",c),this.props.onError&&this.props.onError(i,c)}render(){return this.state.hasError?this.props.fallback||e.jsxs("div",{className:"p-3 border border-red-300 bg-red-50 rounded-lg",children:[e.jsxs("h3",{className:"text-red-800 font-medium text-sm",children:["Error en ",this.props.operation||"la operaciÃ³n"]}),e.jsx("p",{className:"text-red-600 text-xs mt-1",children:this.state.error?.message||"Ha ocurrido un error inesperado."}),e.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"mt-2 px-2 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700",children:"Reintentar"})]}):this.props.children}}const aa=s=>{if(!s)return"/placeholder.svg";if(s.startsWith("http"))return s;const i="https://backend-production-956f.up.railway.app",c=s.startsWith("/")?s:`/${s}`;return`${i}${c}`},ia=(s,i)=>{if(s==null)return"0.0";const c=Number(s);return isNaN(c)?"0.0":c.toFixed(i)},tr=({rating:s,totalRatings:i})=>{const c=s||0;return e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(g=>e.jsx(ye,{className:"w-3 h-3",fill:g<=c?"#f59e0b":"none",color:g<=c?"#f59e0b":"#d1d5db"},g)),e.jsx("span",{className:"text-sm font-medium ml-1",children:ia(s,1)}),i&&i>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",i,")"]})]})},ls=({place:s,onEdit:i,onDelete:c,onManageGallery:g})=>{const[x,y]=l.useState(!1),{getCategoryColor:p}=pa();return e.jsx(Oe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"group h-full flex",children:e.jsxs(Ae,{className:"overflow-hidden shadow-card hover:shadow-xl transition-all duration-300 border-0 bg-white/90 backdrop-blur-sm border-white/30 flex flex-col w-full",children:[e.jsxs("div",{className:"relative h-48 overflow-hidden flex-shrink-0",children:[s.image_url?e.jsxs(e.Fragment,{children:[!x&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-200 to-gray-300 animate-pulse"}),e.jsx("img",{src:aa(s.image_url),alt:s.name||"Lugar turÃ­stico",className:S("w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",x?"opacity-100":"opacity-0"),onLoad:()=>y(!0),onError:()=>y(!0)})]}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-100 to-indigo-100 flex items-center justify-center",children:e.jsx(ze,{className:"h-12 w-12 text-blue-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/10 group-hover:bg-black/20 transition-colors"}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx(le,{className:S(p(s.category),"text-white border-0 shadow-md backdrop-blur-sm"),children:s.category||"Turismo"})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(le,{variant:"secondary",className:"bg-white/90 backdrop-blur-sm",children:[e.jsx(ye,{className:"w-3 h-3 mr-1 fill-yellow-400 text-yellow-400"}),ia(s.average_rating,1)]})})]}),e.jsx(Se,{className:"p-4 flex flex-col flex-1 min-h-0",children:e.jsxs("div",{className:"space-y-3 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-lg leading-tight line-clamp-2 text-gray-900 break-words",children:s.name||"Sin nombre"}),e.jsxs(ra,{children:[e.jsx(sa,{asChild:!0,children:e.jsx(N,{title:"Opciones del lugar",variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx(kr,{className:"h-4 w-4"})})}),e.jsxs(ta,{align:"end",className:"w-48 bg-white/90 backdrop-blur-sm border border-white/20 shadow-lg",children:[e.jsxs(Pe,{onClick:()=>i(s),title:"Editar informaciÃ³n del lugar",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Editar Lugar"]}),e.jsxs(Pe,{onClick:()=>g(s),title:"Gestionar galerÃ­a de imÃ¡genes del lugar",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Gestionar GalerÃ­a"]}),e.jsxs(Pe,{title:"Eliminar lugar y todos sus datos asociados (imÃ¡genes, PDF, etc.)",onClick:()=>c(s),className:"text-destructive",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 flex-shrink-0",children:[e.jsx(ze,{className:"h-3 w-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1 break-words",children:s.location||"UbicaciÃ³n no especificada"})]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(ea,{text:s.description||"",maxLength:120,className:"text-gray-600"})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_r,{className:"h-3 w-3"}),s.total_ratings||0," calificaciones"]}),s.pdf_url&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),"PDF"]})]}),e.jsx(tr,{rating:s.average_rating,totalRatings:s.total_ratings})]})]})})]})})},cs=()=>{const{places:s,loading:i,createPlace:c,updatePlace:g,updatePlaceFast:x,updatePlaceMetadata:y,validarCambiosLugar:p,analizarCambios:C,deletePlace:E,deletePlaceImage:R,deletePlacePDF:A,uploadPlaceImage:D,uploadPlacePDFConModeracion:T,refetch:F,clearError:G}=Pa(),{categories:oe,selectedCategory:_,setSelectedCategory:Q,getCategoryColor:$}=pa(),{modelo:q,cargando:ee,errorModelo:Y,modeloCargado:W,inicializarModelo:k,analizarImagen:V}=Aa(),{toast:P}=Fe(),[ie,ne]=l.useState(!1),[ae,ce]=l.useState(null),[ue,de]=l.useState(!1),[be,ge]=l.useState(!1),[j,pe]=l.useState(null),[he,we]=l.useState(""),[H,o]=l.useState("grid"),[t,r]=l.useState({name:"",description:"",category:"",location:"",image_url:"",pdf_url:""}),[a,d]=l.useState({image:null,pdf:null}),[h,v]=l.useState({}),[U,J]=l.useState(!1),X=l.useRef(null),Ne=l.useRef(null),[re,B]=l.useState(!1),[se,Le]=l.useState(!1);l.useEffect(()=>{Y&&P({title:"âš ï¸ Filtro de seguridad no disponible",description:"Las imÃ¡genes se subirÃ¡n sin anÃ¡lisis de contenido inapropiado",variant:"warning",duration:6e3})},[Y,P]),l.useEffect(()=>{F(),console.log("ðŸš€ Inicializando modelo..."),k()},[F,k]);const m=s.filter(n=>{const u=n.name?.toLowerCase().includes(he.toLowerCase())||n.description?.toLowerCase().includes(he.toLowerCase()),w=_==="all"||n.category===_;return u&&w}),f=()=>{r({name:"",description:"",category:"",location:"",image_url:"",pdf_url:""}),d({image:null,pdf:null}),v({}),pe(null)},b=n=>{r(u=>({...u,location:n.address}))},M=()=>{const n={};if(!j)t.name?.trim()||(n.name="El nombre es requerido"),t.description?.trim()||(n.description="La descripciÃ³n es requerida"),t.category||(n.category="La categorÃ­a es requerida"),t.location?.trim()||(n.location="La ubicaciÃ³n es requerida"),a.image||(n.image="La imagen es requerida para crear un nuevo lugar");else{const u=C(j,t);console.log("ðŸ” Validando en modo ediciÃ³n:",{cambios:u.camposModificados,tieneArchivos:!!a.image||!!a.pdf}),u.nombreModificado&&(t.name?.trim()||(n.name="El nombre no puede estar vacÃ­o")),u.descripcionModificada&&(t.description?.trim()||(n.description="La descripciÃ³n no puede estar vacÃ­a")),u.categoriaModificada&&(t.category||(n.category="La categorÃ­a es requerida")),u.ubicacionModificada&&(t.location?.trim()||(n.location="La ubicaciÃ³n no puede estar vacÃ­a")),a.image&&(a.image.type.startsWith("image/")?a.image.size>5*1024*1024&&(n.image="La imagen no debe superar los 5MB"):n.image="El archivo debe ser una imagen")}return v(n),console.log("ðŸ“‹ Resultado validaciÃ³n:",{errores:Object.keys(n),modo:j?"ediciÃ³n":"creaciÃ³n"}),Object.keys(n).length===0},Z=n=>{if(j){const u=C(j,t);switch(n){case"name":if(!u.nombreModificado)return;break;case"description":if(!u.descripcionModificada)return;break;case"category":if(!u.categoriaModificada)return;break;case"location":if(!u.ubicacionModificada)return;break;case"image":if(!a.image)return;break}}return h[n]},We=async(n,u)=>{if(n==="image"&&u){if(!u.type.startsWith("image/")){v(w=>({...w,image:"El archivo debe ser una imagen"}));return}if(u.size>5*1024*1024){v(w=>({...w,image:"La imagen no debe superar los 5MB"}));return}try{if(B(!0),!q&&!ee){console.warn("âš ï¸ Modelo de moderaciÃ³n no disponible"),d(z=>({...z,[n]:u})),v(z=>({...z,[n]:""})),B(!1);return}ee&&(console.log("ðŸ”„ Esperando a que cargue el modelo..."),await new Promise(z=>setTimeout(z,5e3)));const w=await V(u);if(!w.esAprobado){P({title:"ðŸš« Imagen rechazada",description:`La imagen contiene contenido inapropiado: ${w.razon}`,variant:"destructive",duration:6e3}),v(z=>({...z,[n]:""})),B(!1);return}d(z=>({...z,[n]:u})),v(z=>({...z,[n]:""})),P({title:"âœ… Imagen aprobada",description:"La imagen ha pasado el filtro de seguridad",variant:"default"})}catch(w){console.error("Error analizando imagen:",w),d(z=>({...z,[n]:u})),v(z=>({...z,[n]:""})),P({title:"âš ï¸ Advertencia de seguridad",description:"No se pudo analizar la imagen completamente. Se subirÃ¡ sin verificaciÃ³n.",variant:"warning"})}finally{B(!1)}}else if(n==="pdf"&&u){if(u.type!=="application/pdf"){v(w=>({...w,pdf:"El archivo debe ser un PDF"}));return}if(u.size>10*1024*1024){v(w=>({...w,pdf:"El PDF no debe superar los 10MB"}));return}try{B(!0),P({title:"ðŸ“„ PDF listo para anÃ¡lisis",description:"El PDF serÃ¡ analizado al guardar los cambios",variant:"default",duration:3e3}),d(w=>({...w,[n]:u})),v(w=>({...w,[n]:""})),console.log("âœ… PDF preparado para moderaciÃ³n:",u.name)}catch(w){console.error("Error preparando PDF:",w),v(z=>({...z,[n]:"Error al preparar el PDF"})),P({title:"âŒ Error con PDF",description:"No se pudo preparar el PDF para anÃ¡lisis",variant:"destructive"})}finally{B(!1)}}else d(w=>({...w,[n]:null})),u&&v(w=>({...w,[n]:""}))},na=l.useCallback(()=>j?C(j,t).camposModificados.length>0||!!a.image||!!a.pdf:!!(t.name?.trim()||t.description?.trim()||t.category||t.location?.trim()||a.image||a.pdf),[j,t,a,C]),or=async n=>{if(n.preventDefault(),n.stopPropagation(),U||re){P({title:"â³ OperaciÃ³n en curso",description:"Ya hay una operaciÃ³n en proceso. Por favor espera.",variant:"warning"});return}console.log("ðŸŽ¯ [SUBMIT] Iniciando proceso inteligente..."),J(!0),B(!0);try{if(j){console.log("âœï¸ [SUBMIT] Editando lugar existente...");const u=C(j,t);if(console.log("ðŸ” AnÃ¡lisis de cambios:",u),u.camposModificados.length===0&&(a.image||a.pdf)){console.log("ðŸ“¤ [STRATEGY] Solo subiendo archivos...");const w=[];a.image&&w.push(D(j.id,a.image)),a.pdf&&w.push(T(j.id,a.pdf).catch(L=>{throw console.log("âŒ [SUBMIT] PDF rechazado en proceso:",L),L}));const te=(await Promise.allSettled(w)).filter(L=>L.status==="rejected");te.length===0?P({title:"âœ… Archivos actualizados",description:"Los archivos se han actualizado correctamente"}):console.log("âš ï¸ Algunos archivos fueron rechazados:",te)}else if(!u.requiereModeracion&&u.camposModificados.length>0){console.log("ðŸ“ [STRATEGY] Actualizando solo metadatos...");const w={};u.ubicacionModificada&&(w.location=t.location),u.categoriaModificada&&(w.category=t.category),await y(j.id,{location:w.location,category:w.category});const z=[];a.image&&z.push(D(j.id,a.image)),a.pdf&&z.push(T(j.id,a.pdf)),z.length>0?(await Promise.allSettled(z)).filter(O=>O.status==="rejected").length===0&&P({title:"âœ… Lugar actualizado",description:"La informaciÃ³n se ha actualizado correctamente"}):P({title:"âœ… Lugar actualizado",description:"La informaciÃ³n se ha actualizado correctamente"})}else if(u.requiereModeracion){console.log("ðŸ” [STRATEGY] Cambios en texto - aplicando moderaciÃ³n...");try{const te=await p(j.id,t);if(!te.esAprobado){console.log("âŒ [VALIDATION] ValidaciÃ³n previa fallida:",te.motivo),P({title:"ðŸš« Contenido rechazado",description:te.motivo||"El contenido no cumple con las polÃ­ticas de moderaciÃ³n",variant:"destructive",duration:1e4}),J(!1),B(!1);return}}catch(te){if(console.log("âš ï¸ ValidaciÃ³n previa fallida, continuando...",te),te?.motivo||te?.detalles){J(!1),B(!1);return}}const w={};u.nombreModificado&&(w.name=t.name),u.descripcionModificada&&(w.description=t.description),u.ubicacionModificada&&(w.location=t.location),u.categoriaModificada&&(w.category=t.category),await g(j.id,w,{validarPreviamente:!1});const z=[];a.image&&z.push(D(j.id,a.image)),a.pdf&&z.push(T(j.id,a.pdf)),z.length>0?(await Promise.allSettled(z)).filter(O=>O.status==="rejected").length===0&&P({title:"âœ… Lugar actualizado",description:"El lugar se ha actualizado exitosamente"}):P({title:"âœ… Lugar actualizado",description:"El lugar se ha actualizado exitosamente"})}else{console.log("âš¡ [STRATEGY] ActualizaciÃ³n rÃ¡pida...");const w={};u.nombreModificado&&(w.name=t.name),u.descripcionModificada&&(w.description=t.description),u.ubicacionModificada&&(w.location=t.location),u.categoriaModificada&&(w.category=t.category),await x(j.id,w);const z=[];a.image&&z.push(D(j.id,a.image)),a.pdf&&z.push(T(j.id,a.pdf)),z.length>0?(await Promise.allSettled(z)).filter(O=>O.status==="rejected").length===0&&P({title:"âœ… Lugar actualizado",description:"Los cambios se han guardado correctamente"}):P({title:"âœ… Lugar actualizado",description:"Los cambios se han guardado correctamente"})}}else{if(console.log("ðŸ†• [SUBMIT] Creando nuevo lugar..."),!M()){console.log("âŒ [VALIDATION] ValidaciÃ³n fallida para nuevo lugar"),J(!1),B(!1);return}let u="";if(a.pdf)try{console.log("ðŸ“„ [UPLOAD] Procesando PDF para nuevo lugar...");const L=new FormData;L.append("pdf",a.pdf);const O=await I.post("/api/lugares/pdf-temporal",L,{headers:{"Content-Type":"multipart/form-data"},timeout:45e3});if(!O.data.success||!O.data.moderacion?.esAprobado)throw new Error("PDF no aprobado por moderaciÃ³n");u=O.data.url_pdf,console.log("âœ… [UPLOAD] PDF aprobado para creaciÃ³n:",u)}catch(L){if(console.error("âŒ [UPLOAD] PDF rechazado en creaciÃ³n:",L),L.response?.data){const O=L.response.data;console.log("ðŸ“¦ [PDF ERROR] Datos completos del error:",O);const ke="ðŸš« PDF rechazado";let Ie=O.message||"El contenido del PDF no cumple con las polÃ­ticas";O.detalles?.problemas&&O.detalles.problemas.length>0&&(Ie+=`

Problemas detectados:
â€¢ ${O.detalles.problemas.join(`
â€¢ `)}`),O.detalles?.sugerencias&&O.detalles.sugerencias.length>0&&(Ie+=`

Sugerencias:
â€¢ ${O.detalles.sugerencias.join(`
â€¢ `)}`),O.detalles?.puntuacion&&(Ie+=`

Nivel de riesgo: ${(O.detalles.puntuacion*100).toFixed(1)}%`),P({title:ke,description:Ie,variant:"destructive",duration:1e4})}else if(L?.motivo||L?.detalles){const O="ðŸš« PDF rechazado";let ke=L.motivo||L.message||"El contenido del PDF no cumple con las polÃ­ticas";L.detalles?.problemas&&L.detalles.problemas.length>0&&(ke+=`

Problemas detectados:
â€¢ ${L.detalles.problemas.join(`
â€¢ `)}`),L.detalles?.sugerencias&&L.detalles.sugerencias.length>0&&(ke+=`

Sugerencias:
â€¢ ${L.detalles.sugerencias.join(`
â€¢ `)}`),P({title:O,description:ke,variant:"destructive",duration:1e4})}else L?.message?P({title:"âŒ Error con PDF",description:L.message||"No se pudo procesar el archivo PDF",variant:"destructive"}):P({title:"âŒ Error con PDF",description:"No se pudo procesar el archivo PDF",variant:"destructive"});J(!1),B(!1);return}const w={name:t.name.trim(),description:t.description.trim(),category:t.category,location:t.location.trim(),pdf_url:u};if(console.log("ðŸ“¤ [CREATE] Creando lugar con datos bÃ¡sicos...",{tienePDF:!!u,pdfUrl:u}),!(await c(w,a.image||void 0))?.id)throw new Error("No se pudo obtener el ID del lugar creado");P({title:"âœ… Lugar creado",description:u?"Lugar creado exitosamente con PDF aprobado":"Lugar creado exitosamente"})}console.log("ðŸ [COMPLETED] Proceso terminado exitosamente"),await new Promise(u=>setTimeout(u,500)),de(!1),f(),await F()}catch(u){if(console.error("âŒ [ERROR DETALLADO] Error en handleSubmit:",{error:u,message:u?.message,motivo:u?.motivo,detalles:u?.detalles,tipo:u?.tipo,stack:u?.stack}),!u?.motivo&&!u?.detalles){console.log("âš ï¸ ES ERROR GENÃ‰RICO - Mostrando toast...");const w=u?.message||"Error al procesar la solicitud";P({title:"âŒ Error",description:w,variant:"destructive"})}else console.log("ðŸŽ¯ ES ERROR DE MODERACIÃ“N - Toast ya mostrado en hook")}finally{J(!1),B(!1)}},la=n=>{pe(n),r({name:n.name||"",description:n.description||"",category:n.category||"",location:n.location||"",image_url:n.image_url||"",pdf_url:n.pdf_url||""}),d({image:null,pdf:null}),de(!0)},ir=async()=>{if(!j||!j.image_url){P({title:"â„¹ï¸ InformaciÃ³n",description:"No hay imagen para eliminar",variant:"default"});return}try{console.log("ðŸ—‘ï¸ Eliminando imagen del lugar:",j.id),await R(j.id),r(n=>({...n,image_url:""})),await F()}catch(n){console.error("âŒ Error eliminando imagen:",n)}},nr=async()=>{if(!j||!j.pdf_url){P({title:"â„¹ï¸ InformaciÃ³n",description:"No hay PDF para eliminar",variant:"default"});return}try{console.log("ðŸ—‘ï¸ Eliminando PDF del lugar:",j.id),await A(j.id),r(n=>({...n,pdf_url:""})),await F()}catch(n){console.error("âŒ Error eliminando PDF:",n)}},lr=async()=>{if(!j||se){console.log("ðŸ›‘ EliminaciÃ³n ya en proceso o lugar no seleccionado");return}console.log("ðŸ—‘ï¸ [DELETE] Iniciando eliminaciÃ³n de lugar:",j.id),Le(!0);try{await new Promise(n=>setTimeout(n,100)),await E(j.id),console.log("âœ… [DELETE] Lugar eliminado correctamente"),await new Promise(n=>setTimeout(n,300)),ge(!1),f(),await F(),console.log("ðŸ”„ [DELETE] Lista actualizada despuÃ©s de eliminar")}catch(n){console.error("âŒ [DELETE] Error eliminando lugar:",n)}finally{Le(!1)}},ca=n=>{ce(n),ne(!0)},cr=()=>{ne(!1),ce(null)},dr=()=>{F()},da=n=>{pe(n),ge(!0)},ma=n=>{de(n),n||(f(),G())},mr=async()=>{await F(),P({title:"ðŸ”„ Lista actualizada",description:"Los lugares se han actualizado correctamente"})},ua=n=>{d(u=>({...u,[n]:null})),P({title:"ðŸ—‘ï¸ Archivo removido",description:`El ${n==="image"?"imagen":"PDF"} ha sido removido`,variant:"default"})};return i&&s.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ve,{className:"h-8 w-64"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ve,{className:"h-12 w-full"}),e.jsx(ve,{className:"h-12 w-full"}),e.jsx(ve,{className:"h-12 w-full"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((n,u)=>e.jsxs(Ae,{className:"overflow-hidden",children:[e.jsx(ve,{className:"h-48 w-full"}),e.jsxs(Se,{className:"p-4 space-y-3",children:[e.jsx(ve,{className:"h-6 w-3/4"}),e.jsx(ve,{className:"h-4 w-full"}),e.jsx(ve,{className:"h-4 w-2/3"})]})]},u))})]}):e.jsxs("div",{className:"relative min-h-screen overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center z-0",style:{backgroundImage:"url(https://res.cloudinary.com/dinsl266g/image/upload/v1763114788/Fondos-numericos_wvaraf.svg)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",filter:"blur(4px) brightness(0.9)"}}),e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-[1px] z-0"}),e.jsxs("div",{className:"relative z-10 space-y-6 h-full flex flex-col p-6",children:[e.jsxs(Oe.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 p-6 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h1",{className:"text-4xl font-bold text-white",children:["Administrar ",e.jsx("span",{className:"text-blue-300",children:"Lugares"})]}),e.jsx("p",{className:"text-lg text-gray-200",children:"Gestiona los lugares turÃ­sticos de San Juan Tahitic"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.length," lugares registrados"]})]}),e.jsx("span",{children:"â€¢"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsxs("span",{children:["Promedio: ",ia(s.reduce((n,u)=>n+(u.average_rating||0),0)/(s.length||1),1)]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(N,{title:"Actualizar lista de lugares",variant:"outline",onClick:mr,disabled:i,className:"bg-white/10 text-white border-white/20 hover:bg-white/20 flex gap-2",children:[e.jsx(wa,{className:`h-4 w-4 ${i?"animate-spin":""}`}),"Actualizar"]}),e.jsxs(Be,{open:ue,onOpenChange:ma,children:[e.jsx(va,{asChild:!0,children:e.jsxs(N,{className:"gap-2 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg border-0",children:[e.jsx(zr,{className:"h-4 w-4"}),"Nuevo Lugar"]})}),e.jsxs(qe,{className:"max-w-4xl max-h-[95vh] overflow-hidden bg-slate-900/95 backdrop-blur-sm border border-slate-700 shadow-xl text-white flex flex-col","aria-describedby":void 0,children:[e.jsx(Ve,{className:"flex-shrink-0 pb-4 border-b border-gray-200 px-6 pt-6",children:e.jsx(He,{className:"text-xl font-bold text-white",children:j?"Editar Lugar":"Crear Nuevo Lugar"})}),e.jsx(ns,{children:e.jsxs("form",{onSubmit:or,onKeyDown:n=>{n.key==="Enter"&&n.target.tagName!=="TEXTAREA"&&(n.preventDefault(),n.stopPropagation())},className:"flex flex-col flex-1 min-h-0",noValidate:!0,children:[e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"name",className:"text-white font-medium",children:"Nombre del lugar *"}),e.jsx(je,{id:"name",value:t.name,onChange:n=>r({...t,name:n.target.value}),placeholder:"Ej: Mirador de la Sierra",className:S("border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-black bg-white",Z("name")&&"border-red-500 focus:border-red-500")}),Z("name")&&e.jsx("p",{className:"text-sm text-red-400",children:Z("name")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"category",className:"text-white font-medium",children:"CategorÃ­a *"}),e.jsx(ts,{value:t.category,onValueChange:n=>r({...t,category:n}),error:Z("category"),placeholder:"Selecciona una categorÃ­a",categories:oe})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"location",className:"text-white font-medium",children:"UbicaciÃ³n *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{id:"location",value:t.location,onChange:n=>r({...t,location:n.target.value}),placeholder:"Ej: Centro de San Juan Tahitic",className:S("flex-1 border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-black bg-white",Z("location")&&"border-red-500 focus:border-red-500")}),e.jsx(is,{onLocationSelect:b,currentLocation:t.location,buttonText:"Mapa",className:"w-auto px-4 border-gray-300 hover:border-blue-500"})]}),Z("location")&&e.jsx("p",{className:"text-sm text-red-400",children:Z("location")})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(K,{htmlFor:"description",className:"text-white font-medium",children:"DescripciÃ³n *"}),e.jsxs("span",{className:S("text-sm",t.description.length>1800?"text-amber-400":"text-gray-300"),children:[t.description.length,"/2000 caracteres"]})]}),e.jsx(xa,{id:"description",value:t.description,onChange:n=>{n.target.value.length<=2e3&&r({...t,description:n.target.value})},placeholder:"Describe el lugar, sus caracterÃ­sticas, atractivos, historia, servicios disponibles, horarios, recomendaciones...",rows:6,className:S("min-h-[150px] max-h-[300px] resize-y border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-black bg-white",Z("description")&&"border-red-500 focus:border-red-500")}),Z("description")&&e.jsx("p",{className:"text-sm text-red-400",children:Z("description")}),t.description&&!Z("description")&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Vista previa:"}),e.jsx(ea,{text:t.description,maxLength:200,className:"text-gray-300 bg-gray-900 p-3 rounded border border-gray-700"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{htmlFor:"image_file",className:"text-white",children:["Imagen ",!j&&"*"]}),ee&&e.jsxs(le,{variant:"outline",className:"text-yellow-400 border-yellow-400 text-xs",children:[e.jsx(me,{className:"h-3 w-3 animate-spin mr-1"}),"Cargando filtro de seguridad..."]}),q&&e.jsxs(le,{variant:"outline",className:"text-green-400 border-green-400 text-xs",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),W==="inception_v3"&&"Filtro Avanzado (Inception)",W==="mobilenet_v2"&&"Filtro Seguro (MobileNet)",W==="mobilenet_v2_mid"&&"Filtro Equilibrado (MobileNet Mid)"]}),Y&&e.jsxs(le,{variant:"outline",className:"text-red-400 border-red-400 text-xs",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"Filtro no disponible"]})]}),e.jsxs("div",{className:"text-xs text-blue-200/80 space-y-1",children:[e.jsx("p",{children:"â€¢ Todas las imÃ¡genes pasan por un filtro de contenido inapropiado"}),e.jsx("p",{children:"â€¢ Se rechazan imÃ¡genes con contenido explÃ­cito o sugerente"}),e.jsx("p",{children:"â€¢ MÃ¡ximo 5MB por imagen"})]}),e.jsxs("div",{className:"space-y-2",children:[a.image?e.jsxs("div",{className:"flex items-center justify-between p-3 border-2 border-blue-300/50 rounded-lg bg-blue-500/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:URL.createObjectURL(a.image),alt:"Vista previa",className:"w-12 h-12 object-cover rounded-lg border-2 border-blue-200/50"}),e.jsx("span",{className:"text-sm font-medium text-blue-100 truncate max-w-[120px]",children:a.image.name})]}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>ua("image"),className:"text-blue-200 hover:text-white hover:bg-blue-400/30",children:e.jsx(Ue,{className:"h-4 w-4"})})]}):j?.image_url?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-2 border-green-300/50 rounded-lg bg-green-500/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:aa(j.image_url),alt:"Imagen actual",className:"w-12 h-12 object-cover rounded-lg border-2 border-green-200/50"}),e.jsx("span",{className:"text-sm font-medium text-green-100",children:"Imagen actual"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:()=>X.current?.click(),className:"border-blue-300 text-blue-100 hover:bg-blue-400/30 hover:text-white",children:"Cambiar"})})]}),e.jsxs(N,{title:"Eliminar Imagen",type:"button",variant:"destructive",size:"sm",onClick:ir,className:"w-full bg-red-600 hover:bg-red-700 text-white border-red-600",children:[e.jsx(xe,{className:"h-3 w-3 mr-2"}),"Eliminar Imagen"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-blue-300/50 rounded-lg p-6 text-center cursor-pointer bg-blue-500/10 hover:bg-blue-500/20 transition-all duration-300 backdrop-blur-sm group",onClick:()=>X.current?.click(),children:[e.jsx(Te,{className:"h-10 w-10 mx-auto text-blue-300 mb-3 group-hover:text-blue-200 transition-colors"}),e.jsx("p",{className:"text-sm font-medium text-blue-100 mb-2",children:"Haz clic para seleccionar una imagen"}),e.jsx("p",{className:"text-xs text-blue-200/80 mb-3",children:"PNG, JPG, WEBP (max. 5MB)"}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",className:"border-blue-300 text-blue-100 hover:bg-blue-400/30 hover:text-white hover:border-blue-200",children:[e.jsx(Te,{className:"h-3 w-3 mr-2"}),"Seleccionar Imagen"]})]}),e.jsx(je,{ref:X,id:"image_file",type:"file",accept:"image/*",onChange:n=>We("image",n.target.files?.[0]||null),className:"hidden"}),Z("image")&&e.jsx("p",{className:"text-sm text-red-400 font-medium",children:Z("image")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"pdf_file",className:"text-white",children:"Documento PDF"}),e.jsxs("div",{className:"space-y-2",children:[a.pdf?e.jsxs("div",{className:"flex items-center justify-between p-3 border-2 border-indigo-300/50 rounded-lg bg-indigo-500/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"h-12 w-12 text-indigo-300"}),e.jsx("span",{className:"text-sm font-medium text-indigo-100 truncate max-w-[120px]",children:a.pdf.name})]}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>ua("pdf"),className:"text-indigo-200 hover:text-white hover:bg-indigo-400/30",children:e.jsx(Ue,{className:"h-4 w-4"})})]}):j?.pdf_url?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-2 border-green-300/50 rounded-lg bg-green-500/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"h-12 w-12 text-green-300"}),e.jsx("span",{className:"text-sm font-medium text-green-100",children:"PDF actual"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:()=>Ne.current?.click(),className:"border-indigo-300 text-indigo-100 hover:bg-indigo-400/30 hover:text-white",children:"Cambiar"})})]}),e.jsxs(N,{title:"Eliminar PDF",type:"button",variant:"destructive",size:"sm",onClick:nr,className:"w-full bg-red-600 hover:bg-red-700 text-white border-red-600",children:[e.jsx(xe,{className:"h-3 w-3 mr-2"}),"Eliminar PDF"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-indigo-300/50 rounded-lg p-6 text-center cursor-pointer bg-indigo-500/10 hover:bg-indigo-500/20 transition-all duration-300 backdrop-blur-sm group",onClick:()=>Ne.current?.click(),children:[e.jsx(_e,{className:"h-10 w-10 mx-auto text-indigo-300 mb-3 group-hover:text-indigo-200 transition-colors"}),e.jsx("p",{className:"text-sm font-medium text-indigo-100 mb-2",children:"Haz clic para seleccionar un PDF"}),e.jsx("p",{className:"text-xs text-indigo-200/80 mb-3",children:"Archivo PDF (max. 10MB)"}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",className:"border-indigo-300 text-indigo-100 hover:bg-indigo-400/30 hover:text-white hover:border-indigo-200",children:[e.jsx(_e,{className:"h-3 w-3 mr-2"}),"Seleccionar PDF"]})]}),e.jsx(je,{ref:Ne,id:"pdf_file",type:"file",accept:"application/pdf",onChange:n=>We("pdf",n.target.files?.[0]||null),className:"hidden"})]})]})]})]}),e.jsx("div",{className:"border-t border-gray-700 flex-shrink-0 px-6 py-4 bg-gray-800 flex justify-end items-center gap-3",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>ma(!1),disabled:U||re,className:"bg-red-700 text-white hover:bg-red-600 border-red-600",children:"Cancelar"}),e.jsx(N,{title:"Guardar Lugar",type:"submit",disabled:U||!!j&&!na(),className:"bg-blue-600 text-white hover:bg-blue-700 min-w-24 border-blue-600",children:U?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 animate-spin mr-2"}),j?"Actualizando...":"Creando..."]}):j?na()?"Actualizar":"Sin cambios":"Crear"})]})})]})})]})]})]})]}),e.jsx(Ae,{className:"border border-white/20 shadow-lg bg-white/10 backdrop-blur-sm",children:e.jsx(Se,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 relative",title:"Buscar Lugares",children:[e.jsx(Da,{className:"absolute left-3 top-3 h-4 w-4 text-blue-300"}),e.jsx(je,{placeholder:"Buscar lugares por nombre o descripciÃ³n...",value:he,onChange:n=>we(n.target.value),className:"pl-9 border-white/20 bg-white/10 text-white placeholder-gray-300 focus:border-blue-300 focus:ring-blue-300"})]}),e.jsx(os,{value:_,onValueChange:Q,categories:oe}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{title:"Ver en Modo Cuadricula",variant:H==="grid"?"default":"outline",onClick:()=>o("grid"),className:"flex-1 gap-2 bg-white/10 text-white border-white/20 hover:bg-white/20",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1 w-4 h-4",children:[e.jsx("div",{className:"bg-current rounded-sm"}),e.jsx("div",{className:"bg-current rounded-sm"}),e.jsx("div",{className:"bg-current rounded-sm"}),e.jsx("div",{className:"bg-current rounded-sm"})]}),"CuadrÃ­cula"]}),e.jsxs(N,{title:"Ver en Tabla",variant:H==="table"?"default":"outline",onClick:()=>o("table"),className:"flex-1 gap-2 bg-white/10 text-white border-white/20 hover:bg-white/20",children:[e.jsxs("div",{className:"flex flex-col gap-1 w-4 h-4",children:[e.jsx("div",{className:"bg-current h-1 rounded-sm"}),e.jsx("div",{className:"bg-current h-1 rounded-sm"}),e.jsx("div",{className:"bg-current h-1 rounded-sm"})]}),"Tabla"]})]})]})})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(ur,{mode:"wait",children:H==="grid"?e.jsx(Oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-6",children:m.map(n=>e.jsx(Ee,{operation:`renderizado de card ${n.name}`,fallback:e.jsxs(Ae,{className:"border border-red-200 bg-red-50 p-4 text-center",children:[e.jsx("p",{className:"text-red-600 text-sm",children:"Error mostrando lugar"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),className:"mt-2",children:"Recargar"})]}),children:e.jsx(ls,{place:n,onEdit:la,onDelete:da,onManageGallery:ca})},n.id))})},"grid-view"):e.jsx(Oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full overflow-hidden",children:e.jsxs(Ae,{className:"border border-white/20 shadow-lg h-full flex flex-col bg-white/10 backdrop-blur-sm",children:[e.jsx(pr,{className:"flex-shrink-0 bg-white/10 rounded-t-lg",children:e.jsxs(hr,{className:"text-white",children:["Lugares (",m.length,")"]})}),e.jsx(Se,{className:"flex-1 min-h-0 p-0",children:e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs(ar,{children:[e.jsx(rr,{className:"bg-white/10 sticky top-0",children:e.jsxs(Qe,{children:[e.jsx(Ce,{className:"text-white font-semibold",children:"Lugar"}),e.jsx(Ce,{className:"text-white font-semibold",children:"CategorÃ­a"}),e.jsx(Ce,{className:"text-white font-semibold",children:"UbicaciÃ³n"}),e.jsx(Ce,{className:"text-white font-semibold",children:"CalificaciÃ³n"}),e.jsx(Ce,{className:"text-white font-semibold text-right",children:"Acciones"})]})}),e.jsx(sr,{children:m.map(n=>e.jsxs(Qe,{className:"hover:bg-white/5",children:[e.jsx(De,{className:"max-w-[300px]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[n.image_url&&e.jsx("img",{src:aa(n.image_url),alt:n.name,className:"w-12 h-12 object-cover rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-white truncate",children:n.name}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:e.jsx(ea,{text:n.description||"",maxLength:80,showToggle:!1})})]})]})}),e.jsx(De,{children:e.jsx(le,{variant:"secondary",className:S($(n.category),"text-white backdrop-blur-sm"),children:n.category||"Sin categorÃ­a"})}),e.jsx(De,{className:"max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-300",children:[e.jsx(ze,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.location||"Sin ubicaciÃ³n"})]})}),e.jsx(De,{children:e.jsx(tr,{rating:n.average_rating,totalRatings:n.total_ratings})}),e.jsx(De,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Ee,{operation:"ediciÃ³n de lugar",fallback:e.jsx(N,{variant:"ghost",size:"sm",disabled:!0,className:"text-gray-400",title:"No se puede editar",children:e.jsx($e,{className:"h-4 w-4"})}),children:e.jsx(N,{title:"Editar Lugar",variant:"ghost",size:"sm",onClick:()=>la(n),className:"text-blue-300 hover:text-blue-200 hover:bg-blue-500/30",children:e.jsx($e,{className:"h-4 w-4"})})}),e.jsx(Ee,{operation:"gestiÃ³n de galerÃ­a",fallback:e.jsx(N,{variant:"ghost",size:"sm",disabled:!0,className:"text-gray-400",title:"No se puede gestionar la galerÃ­a",children:e.jsx(Ge,{className:"h-4 w-4"})}),children:e.jsx(N,{title:"Gestionar GalerÃ­a",variant:"ghost",size:"sm",onClick:()=>ca(n),className:"text-green-300 hover:text-green-200 hover:bg-green-500/30",children:e.jsx(Ge,{className:"h-4 w-4"})})}),e.jsx(Ee,{operation:"apertura de diÃ¡logo de eliminaciÃ³n",fallback:e.jsx(N,{variant:"ghost",size:"sm",disabled:!0,className:"text-gray-400",title:"No se puede eliminar",children:e.jsx(xe,{className:"h-4 w-4"})}),children:e.jsx(N,{title:"Eliminar Lugar",variant:"ghost",size:"sm",onClick:()=>da(n),className:"text-red-300 hover:text-red-200 hover:bg-red-500/30",children:e.jsx(xe,{className:"h-4 w-4"})})})]})})]},n.id))})]})})})]})},"table-view")})}),e.jsx(es,{open:be,onOpenChange:ge,children:e.jsx(Ja,{className:"border border-white/20 shadow-2xl bg-white/10 backdrop-blur-sm",children:e.jsxs(Ee,{operation:"eliminaciÃ³n de lugar",children:[e.jsxs(Za,{children:[e.jsx(Xa,{className:"text-red-300",children:"Â¿Eliminar lugar?"}),e.jsxs(Ka,{className:"text-gray-300",children:['Esta acciÃ³n no se puede deshacer. El lugar "',j?.name,'" serÃ¡ eliminado permanentemente junto con todas sus calificaciones y datos asociados.']})]}),e.jsxs(Ya,{children:[e.jsx(er,{className:"border-white/20 text-gray-300 hover:bg-white/10",disabled:se,children:"Cancelar"}),e.jsx(Qa,{onClick:lr,className:"bg-red-600 text-white hover:bg-red-700 disabled:bg-red-400",disabled:se,children:se?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 animate-spin mr-2"}),"Eliminando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Eliminar Permanentemente"]})})]})]})})}),ae&&e.jsx(Ee,{operation:"gestiÃ³n de galerÃ­a",children:e.jsx(Or,{placeId:ae.id,placeName:ae.name,isOpen:ie,onClose:cr,onGalleryUpdate:dr},ae.id)})]})]})};function Ns(){return e.jsxs(e.Fragment,{children:[e.jsx(gr,{}),e.jsx(cs,{})]})}export{Ns as PanelPlaceSection};
